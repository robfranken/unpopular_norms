<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Experiment</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="tweaks.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li>
  <a href="abm.html">
    <span class="fas fa-users"></span>
     
    Agent-based model
  </a>
</li>
<li>
  <a href="experiment.html">
    <span class="fa fa-microscope"></span>
     
    Experiment
  </a>
</li>
<li>
  <a></a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/robfranken/unpopular_norms">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Experiment</h1>
<h4 class="date">Last compiled on 20-11-2025</h4>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<hr />
<div id="getting-started" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Getting started</h1>
<p>To copy the code, click the button in the upper right corner of the
code-chunks.</p>
<div id="clean-up" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> clean up</h2>
<pre class="r test"><code>rm(list = ls())
gc()</code></pre>
<p><br></p>
</div>
<div id="custom-functions" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> custom functions</h2>
<p>We defined a number custom functions, at
<a href="data:text/plain;base64,I2N1c3RvbSBmdW5jdGlvbnMNCiNieSBSb2IgRnJhbmtlbg0KI2xhc3QgZWRpdGVkOiA3LTUtMjAyNQ0KDQojIGZ1bmN0aW9uIHRvIGluc3RhbGwvbG9hZCBwYWNrYWdlcw0KZnBhY2thZ2UuY2hlY2sgPC0gZnVuY3Rpb24ocGFja2FnZXMpIHsNCiAgbGFwcGx5KHBhY2thZ2VzLCBGVU4gPSBmdW5jdGlvbih4KSB7DQogICAgaWYgKCFyZXF1aXJlKHgsIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSkpIHsNCiAgICAgIGluc3RhbGwucGFja2FnZXMoeCwgZGVwZW5kZW5jaWVzID0gVFJVRSkNCiAgICAgIGxpYnJhcnkoeCwgY2hhcmFjdGVyLm9ubHkgPSBUUlVFKQ0KICAgIH0NCiAgfSkNCn0NCg0KIyBmdW5jdGlvbiB0byBzYXZlIGRhdGEgd2l0aCB0aW1lIHN0YW1wIGluIGNvcnJlY3QgZGlyZWN0b3J5DQpmc2F2ZSA8LSBmdW5jdGlvbih4LCBmaWxlLCBsb2NhdGlvbiA9ICIuL2RhdGEvcHJvY2Vzc2VkLyIsIC4uLikgew0KICBpZiAoIWRpci5leGlzdHMobG9jYXRpb24pKQ0KICAgIGRpci5jcmVhdGUobG9jYXRpb24pDQogIGRhdGVuYW1lIDwtIHN1YnN0cihnc3ViKCJbOi1dIiwgIiIsIFN5cy50aW1lKCkpLCAxLCA4KQ0KICB0b3RhbG5hbWUgPC0gcGFzdGUobG9jYXRpb24sIGRhdGVuYW1lLCBmaWxlLCBzZXAgPSAiIikNCiAgcHJpbnQocGFzdGUoIlNBVkVEOiAiLCB0b3RhbG5hbWUsIHNlcCA9ICIiKSkNCiAgc2F2ZSh4LCBmaWxlID0gdG90YWxuYW1lKQ0KfQ0KDQojIGZ1bmN0aW9uIHRvIGxvYWQgUi1vYmplY3RzIHVuZGVyIG5ldyBuYW1lcw0KZmxvYWQgPC0gZnVuY3Rpb24oZmlsZU5hbWUpIHsNCiAgbG9hZChmaWxlTmFtZSkNCiAgZ2V0KGxzKClbbHMoKSAhPSAiZmlsZU5hbWUiXSkNCn0NCg0KIyBwcmludCBvYmplY3RzICh0aWJibGUgLyBkYXRhLmZyYW1lKSBuaWNlbHkgb24gc2NyZWVuIGluIC5SbWQuDQpmc2hvd2RmIDwtIGZ1bmN0aW9uKHgsIC4uLikgew0KICBrbml0cjo6a2FibGUoeCwgZGlnaXRzID0gMiwgImh0bWwiLCAuLi4pICU+JQ0KICAgIGthYmxlRXh0cmE6OmthYmxlX3N0eWxpbmcoYm9vdHN0cmFwX29wdGlvbnMgPSBjKCJzdHJpcGVkIiwgImhvdmVyIikpICU+JQ0KICAgIGthYmxlRXh0cmE6OnNjcm9sbF9ib3god2lkdGggPSAiMTAwJSIsIGhlaWdodCA9ICIzMDBweCIpDQp9DQoNCiMgdmlzdWFsaXplIHBhcmFtZXRlciBzcGFjZXMNCmZkZXNpZ24gPC0gZnVuY3Rpb24oZGYpIHsNCiAgcHVycnI6OmltYXBfZGZyKGRmLCB+bGlzdCgNCiAgICBwYXJhbWV0ZXIgPSAueSwNCiAgICBuX2xldmVscyA9IGxlbmd0aCh1bmlxdWUoLngpKSwNCiAgICBsZXZlbHMgPSBwYXN0ZShzb3J0KHVuaXF1ZSgueCkpLCBjb2xsYXBzZSA9ICIsICIpDQogICkpDQp9DQoNCiMgdmlzdWFsaXplIGdyYXBoIGluIHRoZSAibXVsdGktcG9wdWxhdGlvbiINCmZwbG90X2dyYXBoIDwtIGZ1bmN0aW9uKGdyYXBoLCBtYWluPU5VTEwsIGxheW91dF9hbGdvPU5VTEwsIA0KICAgICAgICAgICAgICAgICAgICAgICAgY29sMSA9ICIjODAwMDgwIiwgY29sMiA9ICAiI0ZGRDcwMCIsIGxlZ2VuZD1UUlVFKSB7DQogIHBsb3QoZ3JhcGgsDQogICAgICAgbWFpbiA9IG1haW4sDQogICAgICAgbGF5b3V0ID0gbGF5b3V0X2FsZ28sDQogICAgICAgdmVydGV4LmxhYmVsID0gTkEsDQogICAgICAgdmVydGV4LnNpemUgPSBkZWdyZWUoZ3JhcGgpKi41ICsgMywgIyBub2RlIHNpemUgYmFzZWQgb24gZGVncmVlDQogICAgICAgdmVydGV4LmNvbG9yID0gaWZlbHNlKFYoZ3JhcGgpJHJvbGUgPT0gInRyZW5kc2V0dGVyIiwgY29sMSwgY29sMiksDQogICAgICAgZWRnZS53aWR0aCA9IDAuNSwNCiAgICAgICANCiAgICAgICBlZGdlLmNvbG9yID0gImRhcmtncmV5IikNCiAgI2FkZCBsZWdlbmQNCiAgaWYobGVnZW5kPT1UUlVFKSB7DQogICAgbGVnZW5kKCJib3R0b21sZWZ0IiwNCiAgICAgICAgICAgbGVnZW5kID0gYygiVHJlbmRzZXR0ZXIiLCAiQ29uZm9ybWlzdCIpLA0KICAgICAgICAgICBwY2ggPSAyMSwNCiAgICAgICAgICAgY29sID0gYyhjb2wxLGNvbDIpLA0KICAgICAgICAgICBwdC5iZyA9IGMoY29sMSxjb2wyKSwNCiAgICAgICAgICAgcHQuY2V4ID0gMywNCiAgICAgICAgICAgYnR5ID0gIm4iKQ0KICB9DQp9DQoNCiMgdXRpbGl0eSBmdW5jdGlvbiANCmZ1dGlsaXR5IDwtIGZ1bmN0aW9uKGFnZW50X2lkLCBjaG9pY2UsIGFnZW50cywgbmV0d29yaywgcGFyYW1zKSB7DQogICMgZ2V0IGVnbyBhbmQgaGlzIGxvY2FsIG5laWdoYm9yaG9vZA0KICBlZ28gPC0gYWdlbnRzW2FnZW50X2lkLCBdDQogIA0KICBuZWlnaGJvcnMgPC0gbmVpZ2hib3JzKG5ldHdvcmssIGVnbyRpZCkNCiAgYWx0ZXJzIDwtIGFnZW50c1thcy5udW1lcmljKG5laWdoYm9ycyksIF0NCiAgbiA8LSBucm93KGFsdGVycykNCiAgDQogICMgcHJvcG9ydGlvbiBvZiBuZWlnaGJvcnMgd2hvIGFkb3B0ZWQgKHApIG9yIHJlc2lzdGVkICgxLXApIHRoZSB0cmVuZA0KICBwIDwtIHN1bShhbHRlcnMkY2hvaWNlID09IDEpIC8gbg0KICBxIDwtIDEgLSBwICAjIHByb3BvcnRpb24gb2YgdHJlbmQtcmVzaXN0YW50IG5laWdoYm9ycw0KICANCiAgIyBjYWxjdWxhdGUgZGltaW5pc2hpbmcgcmV0dXJucyBmdW5jdGlvbg0KICBkaW1pbmlzaGluZ19yZXR1cm5zIDwtIGZ1bmN0aW9uKHgsIHYsIGxhbWJkYSkgew0KICAgIHYgKiAoMSAtIGV4cCgtbGFtYmRhICogeCkpIC8gKDEgLSBleHAoLWxhbWJkYSkpDQogIH0NCiAgDQogICMgY2FsY3VsYXRlIGV4cGVjdGVkIHV0aWxpdHkgKGRlcGVuZGluZyBvbiBhbHRlcnMnIGNob2ljZXMgaW4gcHJpb3Igcm91bmQpDQogIGlmKGVnbyRyb2xlID09ICJjb25mb3JtaXN0Iikgew0KICAgIGlmIChjaG9pY2UgPT0gMCkgeyAjIHJlc2lzdCB0aGUgdHJlbmQNCiAgICAgIGNob2ljZV9wYXlvZmYgPC0gcGFyYW1zJHMgIyBmaXhlZCB1dGlsaXR5IGZvciByZXNpc3RpbmcNCiAgICAgIA0KICAgICAgY29vcmRpbmF0aW9uX3BheW9mZiA8LSBkaW1pbmlzaGluZ19yZXR1cm5zKHEsIHBhcmFtcyR3LCBwYXJhbXMkbGFtYmRhMikNCiAgICB9IGVsc2UgeyAjZm9sbG93IHRoZSB0cmVuZA0KICAgICAgY2hvaWNlX3BheW9mZiA8LSAwDQogICAgICBjb29yZGluYXRpb25fcGF5b2ZmIDwtIGRpbWluaXNoaW5nX3JldHVybnMocCwgcGFyYW1zJHosIHBhcmFtcyRsYW1iZGExKQ0KICAgIH0NCiAgfSBlbHNlIHsgIyB0cmVuZHNldHRlcnMgb25seSBjYXJlIGFib3V0IGZvbGxvd2luZw0KICAgIGlmIChjaG9pY2UgPT0gMSkgew0KICAgICAgY2hvaWNlX3BheW9mZiA8LSBwYXJhbXMkZQ0KICAgIH0gZWxzZSB7DQogICAgICBjaG9pY2VfcGF5b2ZmIDwtIDANCiAgICB9DQogICAgY29vcmRpbmF0aW9uX3BheW9mZiA8LSAwDQogIH0NCiAgDQogICMgcmV0dXJuIHRvdGFsIHV0aWxpdHkgYW5kIGNvdW50cyBvZiBuZWlnaGJvcnMNCiAgcmV0dXJuKGxpc3QodXRpbGl0eSA9IGNob2ljZV9wYXlvZmYgKyBjb29yZGluYXRpb25fcGF5b2ZmLA0KICAgICAgICAgICAgICBuMSA9IHN1bShhbHRlcnMkY2hvaWNlID09IDEpLCAgIyBjb3VudCBvZiB0cmVuZC1hZG9wdGluZyBuZWlnaGJvcnMNCiAgICAgICAgICAgICAgbjAgPSBzdW0oYWx0ZXJzJGNob2ljZSA9PSAwKSkpICMgY291bnQgb2YgdHJlbmQtcmVzaXN0YW50IG5laWdoYm9ycw0KfQ0KDQojIGNyZWF0ZSBhIGRlZ3JlZSBzZXF1ZW5jZSBiYXNlZCBvbiBhIGRpc3RyaWJ1dGlvbg0KZmRlZ3NlcSA8LSBmdW5jdGlvbihuLCBkaXN0ID0gInBvd2VyLWxhdyIsIGFscGhhLCBrX21pbiA9IDEsIGtfbWF4ID0gbiAtIDEsIHNlZWQgPSBOVUxMKSB7DQogIA0KICBpZiAoIWlzLm51bGwoc2VlZCkpIHsgDQogICAgc2V0LnNlZWQoc2VlZCkNCiAgfQ0KICANCiAgIyBnZW5lcmF0ZSBhIGRlZ3JlZSBzZXF1ZW5jZSBiYXNlZCBvbiBhIHBvd2VyLWxhdyBkaXN0cmlidXRpb24gb2YgdGhlIGZvcm0gcChrKSDiiJ0ga157LWFscGhhfQ0KICANCiAgIyBjcmVhdGUgcHJvYmFiaWxpdHkgZGlzdHJpYnV0aW9uDQogIHByb2JzIDwtICgxIC8gKGtfbWluOmtfbWF4KSleYWxwaGENCiAgDQogICMgbm9ybWFsaXplIHByb2JhYmlsaXRpZXMNCiAgcHJvYnMgPC0gcHJvYnMgLyBzdW0ocHJvYnMpIA0KICANCiAgIyBzYW1wbGUgYSBkZWdyZWUgc2VxdWVuY2UNCiAgZGVnc2VxIDwtIHNhbXBsZShrX21pbjprX21heCwgc2l6ZSA9IG4sIHJlcGxhY2UgPSBUUlVFLCBwcm9iID0gcHJvYnMpDQogIA0KICAjIGNvcnJlY3QgdGhlIGRlZ3JlZSBzZXF1ZW5jZSBpZiBpdHMgc3VtIGlzIG9kZCAobmVjZXNzYXJ5IGZvciB0aGUgY29uZmlndXJhdGlvbiBtb2RlbCkNCiAgaWYgKHN1bShkZWdzZXEpICUlIDIgIT0gMCkgew0KICAgIGRlZ3NlcVsxXSA8LSBkZWdzZXFbMV0gKyAxDQogIH0NCiAgDQogIGlmIChkaXN0ID09ICJwb3dlci1sYXciKSB7DQogICAgIyBpZiB0aGUgc3BlY2lmaWVkIGRpc3RyaWJ1dGlvbiB0eXBlIGlzIHBvd2VyLWxhdywgcmV0dXJuIHRoZSBkZWdyZWUgc2VxdWVuY2UNCiAgICByZXR1cm4oZGVnc2VxKQ0KICAgIA0KICB9IGVsc2UgaWYgKGRpc3QgPT0gImxvZy1ub3JtYWwiKSB7DQogICAgIyBpZiB0aGUgc3BlY2lmaWVkIGRpc3RyaWJ1dGlvbiB0eXBlIGlzIGxvZy1ub3JtYWwsIGdlbmVyYXRlIGEgZGVncmVlIHNlcXVlbmNlIGZvbGxvd2luZyB0aGlzIGRpc3RyaWJ1dGlvbjsNCiAgICAjIGJ1dCB3aXRoIGEgc2FtZSBtZWFuIGRlZ3JlZSA8az4gYXMgaXRzICdwb3dlci1sYXcnIGNvdW50ZXJwYXJ0LiB0aGUgc3ByZWFkIGFscGhhID0gMS4gDQogICAgDQogICAgIyBjYWxjdWxhdGUgbWVhbiBkZWdyZWUgaW4gc2VxdWVuY2UNCiAgICBtZWFuX2RlZyA8LSBtZWFuKGRlZ3NlcSkNCiAgICANCiAgICAjIGdlbmVyYXRlIHJhdyBsb2ctbm9ybWFsIGRlZ3JlZSBzZXF1ZW5jZQ0KICAgIHJhd19kZWdzZXEgPC0gcmxub3JtKG4gPSBuLCBtZWFubG9nID0gbG9nKG1lYW5fZGVnKSwgc2Rsb2cgPSAxKQ0KICAgIA0KICAgICMgcmUtc2NhbGUgdGhlIGRlZ3JlZSBzZXF1ZW5jZSB0byBtYXRjaCB0aGUgdGFyZ2V0IG1lYW4gZGVncmVlDQogICAgc2NhbGluZ19mY3RyIDwtIG1lYW5fZGVnIC8gbWVhbihyYXdfZGVnc2VxKQ0KICAgIHNjYWxlZF9kZWdzZXEgPC0gcmF3X2RlZ3NlcSAqIHNjYWxpbmdfZmN0cg0KICAgIA0KICAgICMgYXBwbHkgYm91bmRzIFtrX21pbiwga19tYXhdIGFuZCByb3VuZCB0byBpbnRlZ2VyIHZhbHVlcw0KICAgIGJvdW5kZWRfZGVnc2VxIDwtIHBtaW4ocG1heChyb3VuZChzY2FsZWRfZGVnc2VxKSwga19taW4pLCBrX21heCkNCiAgICANCiAgICAjIHNpbmNlIHRoZSBtZWFuIG1heSBzaGlmdCBhZnRlciByb3VuZGluZyBhbmQgYm91bmRpbmcsIHJlLXNjYWxlIGFnYWluOg0KICAgIHNjYWxpbmdfZmN0cjIgPC0gbWVhbl9kZWcgLyBtZWFuKGJvdW5kZWRfZGVnc2VxKQ0KICAgIGRlZ3NlcSA8LSBwbWluKHBtYXgocm91bmQoYm91bmRlZF9kZWdzZXEgKiBzY2FsaW5nX2ZjdHIyKSwga19taW4pLCBrX21heCkNCiAgICANCiAgICAjIGNvcnJlY3QgdGhlIGRlZ3JlZSBzZXF1ZW5jZSBpZiBpdHMgc3VtIGlzIG9kZCAobmVjZXNzYXJ5IGZvciB0aGUgY29uZmlndXJhdGlvbiBtb2RlbCkNCiAgICBpZiAoc3VtKGRlZ3NlcSkgJSUgMiAhPSAwKSB7DQogICAgICBkZWdzZXFbMV0gPC0gZGVnc2VxWzFdICsgMQ0KICAgIH0NCiAgICByZXR1cm4oZGVnc2VxKQ0KICB9IA0KICBlbHNlIHsNCiAgICBzdG9wKCJJbnZhbGlkIGRpc3RyaWJ1dGlvbiB0eXBlLiBQbGVhc2UgY2hvb3NlICdwb3dlci1sYXcnIG9yICdsb2ctbm9ybWFsJy4iKQ0KICB9DQp9DQoNCiMgY3JlYXRlIGEgInJhbmRvbSIgbmV0d29yayB3aXRoIGEgbWluaW11bSBkZWdyZWUgcmVzdHJpY3Rpb24gDQpmcmFuZGttaW4gPC0gZnVuY3Rpb24obiwgcCwga19taW4gPSAzLCBtYXhfaXRlciA9IDFlMywgdmVyYm9zZSA9IFRSVUUsIHNlZWQgPSBOVUxMKSB7DQogIA0KICBpZiAoIWlzLm51bGwoc2VlZCkpIHsNCiAgICBzZXQuc2VlZChzZWVkKSAgDQogIH0NCiAgDQogICMgRVIgbmV0d29yaw0KICBuZXR3b3JrIDwtIGVyZG9zLnJlbnlpLmdhbWUobiwgcCkNCiAgDQogIGl0ZXIgPC0gMA0KICB3aGlsZSAoaXRlciA8IG1heF9pdGVyKSB7DQogICAgZGVnIDwtIGRlZ3JlZShuZXR3b3JrKQ0KICAgIA0KICAgICMgbG9vayBmb3Igbm9kZXMgd2hvc2UgZGVncmVlIGlzIGxlc3MgdGhhbiBrX21pbg0KICAgIG5vZGVzX2JlbG93X2ttaW4gPC0gd2hpY2goZGVnIDwga19taW4pDQogICAgDQogICAgaWYgKGxlbmd0aChub2Rlc19iZWxvd19rbWluKSA9PSAwKSB7DQogICAgICBpZiAodmVyYm9zZSkgcHJpbnQocGFzdGUoIkl0ZXJhdGlvbiIsIGl0ZXIgKyAxLCAiOiBBbGwgbm9kZXMgaGF2ZSBkZWdyZWUgPj0ga19taW4uIFN0b3BwaW5nLi4uIikpDQogICAgICANCiAgICAgIGJyZWFrDQogICAgfQ0KICAgIA0KICAgICMgcHJvY2VzcyBub2RlcyB0aGF0IGRvbnQgbWVldCBrX21pbg0KICAgIGZvciAoaSBpbiBub2Rlc19iZWxvd19rbWluKSB7DQogICAgICBpZiAoZGVnW2ldID49IGtfbWluKSBuZXh0IA0KICAgICAgaWYgKHZlcmJvc2UpIHByaW50KHBhc3RlKCJOb2RlIiwgaSwgImhhcyBkZWdyZWUiLCBkZWdbaV0sICI8IGtfbWluLiBTdGVhbGluZyBkZWdyZWUuLi4iKSkNCiAgICAgIA0KICAgICAgIyBmaW5kIGEgbm9kZSBqIHdpdGggZGVncmVlID4ga19taW4NCiAgICAgIG5laWdoYm9yc19pIDwtIG5laWdoYm9ycyhuZXR3b3JrLCBpKSAgIyBnZXQgbmVpZ2hib3JzIG9mIG5vZGUgaQ0KICAgICAgY2FuZGlkYXRlc19qIDwtIHNldGRpZmYod2hpY2goZGVnID4ga19taW4pLCBub2Rlc19iZWxvd19rbWluKSAgIyBub2RlcyB3aXRoIGRlZ3JlZSA+IGtfbWluIGFuZCBub3QgYWxyZWFkeSBiZWxvdyBrX21pbg0KICAgICAgDQogICAgICBpZiAobGVuZ3RoKGNhbmRpZGF0ZXNfaikgPT0gMCkgew0KICAgICAgICBpZiAodmVyYm9zZSkgcHJpbnQocGFzdGUoIk5vIGNhbmRpZGF0ZSBqIGZvdW5kIGZvciBub2RlIiwgaSwgIi4gU2tpcHBpbmcuIikpDQogICAgICAgIG5leHQNCiAgICAgIH0NCiAgICAgIA0KICAgICAgaiA8LSBzYW1wbGUoY2FuZGlkYXRlc19qLCAxKSAgIyBzYW1wbGUgb25lIG5vZGUgaiBmcm9tIGNhbmRpZGF0ZXMNCiAgICAgIA0KICAgICAgaWYgKHZlcmJvc2UpIHByaW50KHBhc3RlKCJOb2RlIiwgaiwgImlzIGEgY2FuZGlkYXRlIGZvciBzdGVhbGluZyBkZWdyZWUuIikpDQogICAgICANCiAgICAgICMgZmluZCBhIG5laWdoYm9yIG0gb2Ygbm9kZSBqIHRvICJzdGVhbCIgdGhlIGVkZ2UgZnJvbQ0KICAgICAgbmVpZ2hib3JzX2ogPC0gbmVpZ2hib3JzKG5ldHdvcmssIGopDQogICAgICBtIDwtIHNhbXBsZShuZWlnaGJvcnNfaiwgMSkgICMgUmFuZG9tbHkgc2VsZWN0IG9uZSBvZiBqJ3MgbmVpZ2hib3JzDQogICAgICANCiAgICAgIGlmIChkZWdbbV0gPD0ga19taW4pIHsNCiAgICAgICAgaWYgKHZlcmJvc2UpIHByaW50KHBhc3RlKCJOb2RlIiwgbSwgImhhcyBkZWdyZWUgPD0ga19taW4uIFNraXBwaW5nIHRoaXMgbmVpZ2hib3IuIikpDQogICAgICAgIG5leHQNCiAgICAgIH0NCiAgICAgIA0KICAgICAgaWYgKHZlcmJvc2UpIHByaW50KHBhc3RlKCJOb2RlIiwgaiwgImlzIGNvbm5lY3RlZCB0byBub2RlIiwgbSwgIi4gU3RlYWxpbmcgZWRnZS4iKSkNCiAgICAgIA0KICAgICAgIyBjaGVjayBpZiB0aGUgZWRnZSBleGlzdHMgYmV0d2VlbiBqIGFuZCBtIGJlZm9yZSBhdHRlbXB0aW5nIHRvIHJlbW92ZSBpdA0KICAgICAgZWRnZV9leGlzdHMgPC0gYW55KGVuZHMobmV0d29yaywgRShuZXR3b3JrKSlbLDFdID09IGogJiBlbmRzKG5ldHdvcmssIEUobmV0d29yaykpWywyXSA9PSBtIHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHMobmV0d29yaywgRShuZXR3b3JrKSlbLDFdID09IG0gJiBlbmRzKG5ldHdvcmssIEUobmV0d29yaykpWywyXSA9PSBqKQ0KICAgICAgDQogICAgICBpZiAoZWRnZV9leGlzdHMpIHsNCiAgICAgICAgIyByZW1vdmUgdGhlIGVkZ2UgYmV0d2VlbiBqIGFuZCBtLCBhbmQgYWRkIGFuIGVkZ2UgYmV0d2VlbiBpIGFuZCBtDQogICAgICAgIG5ldHdvcmsgPC0gZGVsZXRlX2VkZ2VzKG5ldHdvcmssIGdldC5lZGdlLmlkcyhuZXR3b3JrLCBjKGosIG0pKSkgICMgdXNlIGVkZ2UgSUQgaW5zdGVhZA0KICAgICAgICBuZXR3b3JrIDwtIGFkZF9lZGdlcyhuZXR3b3JrLCBjKGksIG0pKSAgICAjIGRkZCB0aGUgZWRnZSBiZXR3ZWVuIGkgYW5kIG0NCiAgICAgICAgDQogICAgICAgICMgdXBkYXRlIHRoZSBkZWdyZWUgdmVjdG9yDQogICAgICAgIGRlZyA8LSBkZWdyZWUobmV0d29yaykNCiAgICAgICAgDQogICAgICAgIGlmICh2ZXJib3NlKSBwcmludChwYXN0ZSgiTm9kZSIsIGksICJub3cgaGFzIGRlZ3JlZSIsIGRlZ1tpXSkpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAodmVyYm9zZSkgcHJpbnQocGFzdGUoIk5vIGVkZ2UgZXhpc3RzIGJldHdlZW4gbm9kZSIsIGosICJhbmQgbm9kZSIsIG0sICJTa2lwcGluZy4uLiIpKQ0KICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAjIGluY3JlbWVudCBpdGVyYXRpb24gY291bnRlcg0KICAgIGl0ZXIgPC0gaXRlciArIDENCiAgICBpZiAodmVyYm9zZSkgcHJpbnQocGFzdGUoIkl0ZXJhdGlvbiIsIGl0ZXIsICJjb21wbGV0ZWQuIikpDQogIH0NCiAgDQogIHJldHVybihuZXR3b3JrKQ0KfQ0KDQojIHJld2lyaW5nIGFsZ29yaXRobSB0byBtYW5pcHVsYXRlIGEgbmV0d29yaydzIGRlZ3JlZSBhc3NvcnRhdGl2aXR5ICh3aXRob3V0IGNoYW5naW5nIHRoZSBkZWdyZWUgZGlzdHJpYnV0aW9uKQ0KZnJld2lyZV9yIDwtIGZ1bmN0aW9uKG5ldHdvcmssIHRhcmdldF9yLCBtYXhfaXRlciA9IDFlNSwgdG9sID0gMC4wMSwgdmVyYm9zZSA9IFRSVUUpIHsNCiAgDQogIGN1cnJlbnRfciA8LSBhc3NvcnRhdGl2aXR5X2RlZ3JlZShuZXR3b3JrKQ0KICBpdGVyYXRpb24gPC0gMQ0KICANCiAgaWYgKHZlcmJvc2UpIHsNCiAgICBjYXQoIlRhcmdldCBhc3NvcnRhdGl2aXR5IGNvZWZmaWNpZW50OiIsIHRhcmdldF9yLCAiXG4iKQ0KICAgIGNhdCgiU3RhcnRpbmcgYXNzb3J0YXRpdml0eSBjb2VmZmljaWVudDoiLCBjdXJyZW50X3IsICJcbiIpDQogICAgY2F0KCJUb2xlcmFuY2U6IiwgdG9sLCAiXG4iKQ0KICB9DQogIA0KICB3aGlsZSAoYWJzKGN1cnJlbnRfciAtIHRhcmdldF9yKSA+IHRvbCAmJiBpdGVyYXRpb24gPCBtYXhfaXRlcikgew0KICAgIA0KICAgICMgZ2V0IG5ldHdvcmsgZWRnZXMNCiAgICBlZGdlcyA8LSBFKG5ldHdvcmspDQogICAgIyB0byBlZGdlbGlzdA0KICAgIGVkZ2VfbGlzdCA8LSBlbmRzKG5ldHdvcmssIGVkZ2VzKQ0KICAgIA0KICAgICMgcmFuZG9tbHkgc2VsZWN0IHR3byBwYWlycyBvZiBjb25uZWN0ZWQgbm9kZXMNCiAgICBpZHgxIDwtIHNhbXBsZSgxOm5yb3coZWRnZV9saXN0KSwgMSkNCiAgICBpZHgyIDwtIHNhbXBsZSgxOm5yb3coZWRnZV9saXN0KSwgMSkNCiAgICANCiAgICAjIGV4dHJhY3Qgbm9kZSBpbmRpY2VzDQogICAgdTEgPC0gZWRnZV9saXN0W2lkeDEsIDFdICMgbm9kZSAxIG9mIGZpcnN0IGVkZ2UNCiAgICB2MSA8LSBlZGdlX2xpc3RbaWR4MSwgMl0gIyBub2RlIDIgb2YgZmlyc3QgZWRnZQ0KICAgIHUyIDwtIGVkZ2VfbGlzdFtpZHgyLCAxXSAjIGV0Yw0KICAgIHYyIDwtIGVkZ2VfbGlzdFtpZHgyLCAyXSANCiAgICANCiAgICAjIGNoZWNrIGlmIHRoZSB0d28gcGFpcnMgb2YgY29ubmVjdGVkIG5vZGVzICh1MSwgdjE7IHUyLCB2MikgYXJlIGRpc2pvaW50DQogICAgaWYgKGxlbmd0aCh1bmlxdWUoYyh1MSwgdjEsIHUyLCB2MikpKSA9PSA0KSB7DQogICAgICAjIGNoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYW4gZWRnZSBhY3Jvc3MgdGhlIG5vZGUtcGFpcnMNCiAgICAgICMgZW5zdXJlIG5vIGxvb3BzIGFuZCBubyBkdXBsaWNhdGUgZWRnZXMNCiAgICAgIGlmICghYXJlX2FkamFjZW50KG5ldHdvcmssIHUxLCB1MikgJiYgIWFyZV9hZGphY2VudChuZXR3b3JrLCB2MSwgdjIpICYmIHUxICE9IHYyICYmIHUyICE9IHYxKSB7DQogICAgICAgIA0KICAgICAgICAjIHBlcmZvcm0gdGhlIGVkZ2Ugc3dhcCAodTEsdjEpIDwtPiAodTIsdjIpIGJlY29tZXMgKHUxLHYyKSA8LT4gKHUyLHYxKQ0KICAgICAgICBuZXdfbmV0d29yayA8LSBuZXR3b3JrICMgY29weSBuZXR3b3JrDQogICAgICAgIA0KICAgICAgICAjIGNoZWNrIGlmIHRoZSBuZXcgZWRnZXMgYWxyZWFkeSBleGlzdCB0byBhdm9pZCBkdXBsaWNhdGVzDQogICAgICAgIGlmICghYXJlX2FkamFjZW50KG5ld19uZXR3b3JrLCB1MSwgdjIpICYmICFhcmVfYWRqYWNlbnQobmV3X25ldHdvcmssIHUyLCB2MSkpIHsNCiAgICAgICAgICAjIGFkZCBlZGdlcw0KICAgICAgICAgIG5ld19uZXR3b3JrIDwtIGFkZF9lZGdlcyhuZXdfbmV0d29yaywgYyh1MSwgdjIsIHUyLCB2MSkpDQogICAgICAgICAgIyByZW1vdmUgZWRnZXMNCiAgICAgICAgICBuZXdfbmV0d29yayA8LSBkZWxldGVfZWRnZXMobmV3X25ldHdvcmssIGdldC5lZGdlLmlkcyhuZXdfbmV0d29yaywgYyh1MSwgdjEsIHUyLCB2MikpKQ0KICAgICAgICAgIA0KICAgICAgICAgICMgbmV3IGFzc29ydGF0aXZpdHkNCiAgICAgICAgICBuZXdfciA8LSBhc3NvcnRhdGl2aXR5X2RlZ3JlZShuZXdfbmV0d29yaykNCiAgICAgICAgICANCiAgICAgICAgICAjIGFjY2VwdCB0aWUgc3dhcCBpZiBpdCBicmluZ3MgdXMgY2xvc2VyIHRvIHRoZSB0YXJnZXQgYXNzb3J0YXRpdml0eQ0KICAgICAgICAgIGlmIChhYnMobmV3X3IgLSB0YXJnZXRfcikgPCBhYnMoY3VycmVudF9yIC0gdGFyZ2V0X3IpKSB7DQogICAgICAgICAgICBjdXJyZW50X3IgPC0gbmV3X3INCiAgICAgICAgICAgIG5ldHdvcmsgPC0gbmV3X25ldHdvcmsNCiAgICAgICAgICAgIGlmICh2ZXJib3NlKSB7IA0KICAgICAgICAgICAgICBjYXQoIlJld2lyaW5nIGF0IGl0ZXJhdGlvbiIsIGl0ZXJhdGlvbiwgImJyb3VnaHQgYXNzb3J0YXRpdml0eSBjbG9zZXIgdG8gdGFyZ2V0ISBDdXJyZW50IGFzc29ydGF0aXZpdHkgY29lZmZpY2llbnQ6IiwgbmV3X3IsICJcbiIpDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGl0ZXJhdGlvbiA8LSBpdGVyYXRpb24gKyAxDQogIH0NCiAgDQogIGlmICh2ZXJib3NlKSB7DQogICAgY2F0KCJGaW5hbCBhc3NvcnRhdGl2aXR5IGNvZWZmaWNpZW50OiIsIGN1cnJlbnRfciwgIlxuIikNCiAgICBpZiAoYWJzKGN1cnJlbnRfciAtIHRhcmdldF9yKSA8PSB0b2wpIHsNCiAgICAgIGNhdCgiVGFyZ2V0IHJlYWNoZWQgd2l0aGluIHRvbGVyYW5jZS5cbiIpDQogICAgfSBlbHNlIHsNCiAgICAgIGNhdCgiUmVhY2hlZCBtYXhpbXVtIGl0ZXJhdGlvbnMgd2l0aG91dCBtZWV0aW5nIHRhcmdldC5cbiIpDQogICAgfQ0KICB9DQogIA0KICByZXR1cm4obmV0d29yaykNCn0NCg0KIyBhbGdvcml0aG0gdG8gbWFuaXB1bGF0ZSB0aGUgZGVncmVlLXRyYWl0IGNvcnJlbGF0aW9uDQpmZGVndHJhaXRjb3IgPC0gZnVuY3Rpb24obmV0d29yaykgew0KICByb2xlcyA8LSBpZmVsc2UoVihuZXR3b3JrKSRyb2xlID09ICJ0cmVuZHNldHRlciIsIDEsIDApDQogIGRlZ3JlZXMgPC0gZGVncmVlKG5ldHdvcmspDQogIHJldHVybihsaXN0KGNvciA9IGNvcihyb2xlcywgZGVncmVlcyksIHJvbGVzID0gcm9sZXMsIGRlZ3JlZXMgPSBkZWdyZWVzKSkNCn0NCg0KI3N3YXBwaW5nIGZ1bmN0aW9uIHRvIGFkanVzdCBkZWdyZWUtdHJhaXQgY29ycmVsYXRpb24NCmZzd2FwX3JobyA8LSBmdW5jdGlvbihuZXR3b3JrLCB0YXJnZXRfcmhvLCBtYXhfaXRlciA9IDFlMywgdG9sID0gMC4wNSwgdmVyYm9zZSA9IFRSVUUpIHsNCiAgDQogIGN1cnJlbnQgPC0gZmRlZ3RyYWl0Y29yKG5ldHdvcmspDQogIGl0ZXJhdGlvbiA8LSAxDQogIGJlc3RfbmV0d29yayA8LSBuZXR3b3JrDQogIGJlc3RfcmhvIDwtIGN1cnJlbnQkY29yDQogIA0KICBpZiAodmVyYm9zZSkgew0KICAgIGNhdCgiVGFyZ2V0IGRlZ3JlZS10cmFpdCBjb3JyZWxhdGlvbjoiLCB0YXJnZXRfcmhvLCAiXG4iKQ0KICAgIGNhdCgiU3RhcnRpbmcgZGVncmVlLXRyYWl0IGNvcnJlbGF0aW9uOiIsIGN1cnJlbnQkY29yLCAiXG4iKQ0KICAgIGNhdCgiVG9sZXJhbmNlOiIsIHRvbCwgIlxuXG4iKQ0KICB9DQogIA0KICB3aGlsZSAoaXRlcmF0aW9uIDw9IG1heF9pdGVyKSB7DQogICAgIyBjaGVjayBpZiB3ZSBhcmUgYWxyZWFkeSB3aXRoaW4gdG9sZXJhbmNlDQogICAgaWYgKGFicyhjdXJyZW50JGNvciAtIHRhcmdldF9yaG8pIDw9IHRvbCkgew0KICAgICAgaWYgKHZlcmJvc2UpIGNhdCgiVGFyZ2V0IHJlYWNoZWQgd2l0aGluIHRvbGVyYW5jZSBhdCBpdGVyYXRpb24iLCBpdGVyYXRpb24sICIuXG4iKQ0KICAgICAgYnJlYWsNCiAgICB9DQogICAgDQogICAgIyByYW5kb21seSBzZWxlY3Qgbm9kZXMgZm9yIHN3YXBwaW5nDQogICAgdjEgPC0gc2FtcGxlKHdoaWNoKGN1cnJlbnQkcm9sZXMgPT0gMSksIDEpDQogICAgdjAgPC0gc2FtcGxlKHdoaWNoKGN1cnJlbnQkcm9sZXMgPT0gMCksIDEpDQogICAgDQogICAgIyBnZXQgZGVncmVlcyBvZiBzZWxlY3RlZCBub2Rlcw0KICAgIGsxIDwtIGN1cnJlbnQkZGVncmVlc1t2MV0NCiAgICBrMCA8LSBjdXJyZW50JGRlZ3JlZXNbdjBdDQogICAgDQogICAgIyBzd2FwIHJvbGVzIGlmIGNvbmRpdGlvbiBrX3YwID4ga192MSBpcyBtZXQNCiAgICBpZiAoazAgPiBrMSkgew0KICAgICAgY3VycmVudCRyb2xlc1t2MV0gPC0gMA0KICAgICAgY3VycmVudCRyb2xlc1t2MF0gPC0gMQ0KICAgICAgDQogICAgICAjIHVwZGF0ZSBncmFwaCByb2xlcw0KICAgICAgVihuZXR3b3JrKSRyb2xlIDwtIGlmZWxzZShjdXJyZW50JHJvbGVzID09IDEsICJ0cmVuZHNldHRlciIsICJjb25mb3JtaXN0IikNCiAgICAgIA0KICAgICAgIyByZWNhbGN1bGF0ZSBkZWdyZWUtdHJhaXQgY29ycmVsYXRpb24NCiAgICAgIGN1cnJlbnQgPC0gZmRlZ3RyYWl0Y29yKG5ldHdvcmspDQogICAgICANCiAgICAgICMgY2hlY2sgaWYgdGhpcyBpcyB0aGUgY2xvc2VzdCBjb3JyZWxhdGlvbiB0byB0aGUgdGFyZ2V0IHNvIGZhcg0KICAgICAgaWYgKGFicyhjdXJyZW50JGNvciAtIHRhcmdldF9yaG8pIDwgYWJzKGJlc3RfcmhvIC0gdGFyZ2V0X3JobykpIHsNCiAgICAgICAgYmVzdF9uZXR3b3JrIDwtIG5ldHdvcmsNCiAgICAgICAgYmVzdF9yaG8gPC0gY3VycmVudCRjb3INCiAgICAgICAgaWYgKHZlcmJvc2UpIHsNCiAgICAgICAgICBjYXQoIlRyYWl0LXN3YXBwaW5nIGF0IGl0ZXJhdGlvbiIsIGl0ZXJhdGlvbiwgImJyb3VnaHQgY29ycmVsYXRpb24gY2xvc2VyIHRvIHRhcmdldCEgQ3VycmVudCBjb3JyZWxhdGlvbjoiLCBjdXJyZW50JGNvciwgIlxuIikNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICBpdGVyYXRpb24gPC0gaXRlcmF0aW9uICsgMQ0KICB9DQogIA0KICAjIGNoZWNrIGlmIHRoZSBmaW5hbCBjb3JyZWxhdGlvbiBpcyB3b3JzZSB0aGFuIHRoZSBiZXN0IGNvcnJlbGF0aW9uDQogIGZpbmFsX2NvcnJlbGF0aW9uIDwtIGN1cnJlbnQkY29yDQogIGlmIChhYnMoZmluYWxfY29ycmVsYXRpb24gLSB0YXJnZXRfcmhvKSA+IGFicyhiZXN0X3JobyAtIHRhcmdldF9yaG8pKSB7DQogICAgaWYgKHZlcmJvc2UpIHsNCiAgICAgIGNhdCgiXG5XYXJuaW5nOiBGaW5hbCBpdGVyYXRpb24gbWFkZSB0aGUgY29ycmVsYXRpb24gd29yc2UuIFJldmVydGluZyB0byBiZXN0IG9ic2VydmVkIGNvcnJlbGF0aW9uLlxuIikNCiAgICB9DQogIH0NCiAgDQogIGlmICh2ZXJib3NlKSB7DQogICAgY2F0KCJcbkZpbmFsIGRlZ3JlZS10cmFpdCBjb3JyZWxhdGlvbjoiLCBiZXN0X3JobywgIlxuIikNCiAgICBpZiAoYWJzKGJlc3RfcmhvIC0gdGFyZ2V0X3JobykgPD0gdG9sKSB7DQogICAgICBjYXQoIlRhcmdldCByZWFjaGVkIHdpdGhpbiB0b2xlcmFuY2UuXG4iKQ0KICAgIH0gZWxzZSBpZiAoaXRlcmF0aW9uID4gbWF4X2l0ZXIpIHsNCiAgICAgIGNhdCgiUmVhY2hlZCBtYXhpbXVtIGl0ZXJhdGlvbnMgd2l0aG91dCBtZWV0aW5nIHRhcmdldC5cbiIpDQogICAgfQ0KICB9DQogIHJldHVybihiZXN0X25ldHdvcmspDQp9DQoNCmZjYWxjdWxhdGVfbWFqb3JpdHlfaWxsdXNpb24gPC0gZnVuY3Rpb24obmV0d29yaywgdGhyZXNob2xkID0gMC40OSkgew0KICByb2xlcyA8LSBWKG5ldHdvcmspJHJvbGUNCiAgYWN0aW9ucyA8LSBWKG5ldHdvcmspJGFjdGlvbg0KICANCiAgI2luaXRpYWxpemUgY291bnRlciBmb3IgbWFqb3JpdHkgaWxsdXNpb24NCiAgbWlfY291bnQgPC0gMA0KICANCiAgI2xvb3Agb3ZlciBjb25mb3JtaXN0cw0KICBmb3IgKHYgaW4gVihuZXR3b3JrKSkgew0KICAgIGlmIChyb2xlc1t2XSA9PSAiY29uZm9ybWlzdCIpIHsNCiAgICAgIG5laWdoYm9ycyA8LSBuZWlnaGJvcnMobmV0d29yaywgdikNCiAgICAgIHRyZW5kX25laWdoYm9ycyA8LSBzdW0oYWN0aW9uc1tuZWlnaGJvcnNdID09IDEpDQogICAgICBwcm9wX3RyZW5kIDwtIHRyZW5kX25laWdoYm9ycyAvIGxlbmd0aChuZWlnaGJvcnMpDQogICAgICANCiAgICAgIGlmIChwcm9wX3RyZW5kID4gdGhyZXNob2xkKSB7ICN1bmRlciAid2VhayBpbmZsdWVuY2UiLCBtb3JlIHRoYW4gaGFsZiBvZiB0aGUgbmVpZ2hib3Job29kIHN1ZmZpY2VzOyBzbyBzZXQgdGhyZXNob2xkIGF0IC41DQogICAgICAgIG1pX2NvdW50IDwtIG1pX2NvdW50ICsgMQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICAjIHJldHVybiBmcmFjdGlvbiBvZiBjb25mb3JtaXN0cyB3aG8gaGF2ZSBtYWpvcml0eSBpbGx1c2lvbg0KICByZXR1cm4obWlfY291bnQgLyBzdW0ocm9sZXMgPT0gImNvbmZvcm1pc3QiKSkNCn0NCg0KIyBmdW5jdGlvbiBmb3Igb3VyIGV2b2x1dGlvbmFyeSBtb2RlbA0KZmFibSA8LSBmdW5jdGlvbihuZXR3b3JrID0gbmV0d29yaywgIyB0aGUgZ2VuZXJhdGVkIG5ldHdvcmsNCiAgICAgICAgICAgICAgICAgbWF4X3JvdW5kcyA9IDUwLCAjIG1heCBudW1iZXIgb2YgdGltZXN0ZXBzL3JvdW5kcw0KICAgICAgICAgICAgICAgICBjaG9pY2VfcnVsZSA9ICJkZXRlcm1pbmlzdGljIiwNCiAgICAgICAgICAgICAgICAgZXBzaWxvbiA9IC4xMCwgIyBmbGlwcGluZyBwcm9iYWJpbGl0eSBkcmF3biBhbmV3IGZvciBlYWNoIGFnZW50IGVhY2ggcm91bmQNCiAgICAgICAgICAgICAgICAgdXRpbGl0eV9mbiA9IGZ1dGlsaXR5LCAjIHRoZSB1dGlsaXR5IGZ1bmN0aW9uDQogICAgICAgICAgICAgICAgIHBhcmFtcyA9IGxpc3Qocz0xNSwgZT0xMCwgdz00MCwgej01MCwgbGFtYmRhMT00LjMsIGxhbWJkYTI9MS44KSwgIyB1dGlsaXR5IHBhcmFtZXRlcnMNCiAgICAgICAgICAgICAgICAgbWlfdGhyZXNob2xkID0gaWZlbHNlKHBhcmFtcyR6ID4gNTAsIC40OSwgLjUwKSwgIyB0aHJlc2hvbGQgZm9yIGluZmx1ZW5jZQ0KICAgICAgICAgICAgICAgICBzdGFibGVfd2luZG93ID0gNSwgIyBudW1iZXJzIG9mIHJlY2VudCByb3VuZHMgdG8gYXNzZXNzIHN0YXRpb25hcml0eQ0KICAgICAgICAgICAgICAgICByZXF1aXJlZF9zdGFibGVfcm91bmRzID0gNCwgIyBjb25zZWN1dGl2ZSB3aW5kb3dzIG5lZWRlZCB0byBjb25maXJtIHN0b2NoYXN0aWMgZXF1aWxpYnJpdW0NCiAgICAgICAgICAgICAgICAgaGlzdG9yaWVzID0gRkFMU0UsICMgcmV0dXJuIGRlY2lzaW9uIGhpc3RvcnkNCiAgICAgICAgICAgICAgICAgb3V0Y29tZSA9IFRSVUUsICMgcmV0dXJuIG91dGNvbWVzDQogICAgICAgICAgICAgICAgIHBsb3QgPSBGQUxTRSApIHsgIyByZXR1cm4gcGxvdA0KICANCiAgIyBtYWtlIGFuIGFnZW50cyBkYXRhZnJhbWUNCiAgYWdlbnRzIDwtIHRpYmJsZSgNCiAgICBpZCA9IDE6bGVuZ3RoKG5ldHdvcmspLA0KICAgIHJvbGUgPSBWKG5ldHdvcmspJHJvbGUsDQogICAgcHJlZmVyZW5jZSA9IGlmZWxzZShWKG5ldHdvcmspJHJvbGUgPT0gInRyZW5kc2V0dGVyIiwgMSwgMCksICMgMSA9IGZvbGxvdyB0cmVuZCwgMCA9IG5vdCBmb2xsb3cNCiAgICBjaG9pY2UgPSBOQQ0KICApDQogIA0KICAjIGluaXRpYWxpemUgZGVjaXNpb24gaGlzdG9yeSANCiAgZGVjaXNpb25faGlzdG9yeSA8LSB0aWJibGUoKSAjIGFsbCBkZWNpc2lvbnMgKHV0aWxpdGllcyArIGVycm9ycykNCiAgYWRvcHRpb25faGlzdG9yeSA8LSBjKCkgIyBudW1iZXIgb2YgYWRvcHRlcnMgb3ZlciB0aW1lDQogIA0KICAjIGFsc28gaW5pdGlhbGl6ZSBhbiBlcXVpbGlicml1bSBmbGFnDQogIGVxdWlsaWJyaXVtX3JlYWNoZWQgPC0gRkFMU0UNCiAgZXF1aWxpYnJpdW1fdCA8LSBOQQ0KICANCiAgIyBzaW11bGF0aW9uIHVudGlsIGVxdWlsaWJyaXVtIHJlYWNoZWQNCiAgdCA8LSAxDQogIHN0YWJsZV9yb3VuZHMgPC0gMCAjIGZvciBzdG9jaGFzdGljIGVxdWlsaWJyaXVtIHVzZSBhIGNvdW50ZXINCiAgc3RhYmxlX3RocmVzaG9sZCA8LSBlcHNpbG9uIC8gMiAgIyBzZXQgc3RhYmxlIHRocmVzaG9sZCAoaS5lLiwgc2QgdGhyZXNob2xkIHVuZGVyIHdoaWNoIGEgd2luZG93IGlzIGNvbnNpZGVyZWQgc3RhYmxlKSB0byBoYWxmIG9mIGVwc2lsb24NCiAgDQogIHdoaWxlICh0IDw9IG1heF9yb3VuZHMgJiYgIWVxdWlsaWJyaXVtX3JlYWNoZWQpIHsNCiAgICBpZiAodCA9PSAxKSB7DQogICAgICBhZ2VudHMgPC0gYWdlbnRzICU+JQ0KICAgICAgICBtdXRhdGUoY2hvaWNlID0gcHJlZmVyZW5jZSkNCiAgICB9IGVsc2Ugew0KICAgICAgYWdlbnRzIDwtIGFnZW50cyAlPiUNCiAgICAgICAgcm93d2lzZSgpICU+JQ0KICAgICAgICBtdXRhdGUoDQogICAgICAgICAgdXRpbF8xID0gdXRpbGl0eV9mbihpZCwgMSwgYWdlbnRzLCBuZXR3b3JrLCBwYXJhbXMpJHV0aWxpdHksDQogICAgICAgICAgdXRpbF8wID0gdXRpbGl0eV9mbihpZCwgMCwgYWdlbnRzLCBuZXR3b3JrLCBwYXJhbXMpJHV0aWxpdHksDQogICAgICAgICAgcmF0aW9uYWxfY2hvaWNlID0gaWZlbHNlKHV0aWxfMSA+IHV0aWxfMCwgMSwgMCksDQogICAgICAgICAgZXJyb3IgPSBydW5pZigxKSA8IGVwc2lsb24sDQogICAgICAgICAgY2hvaWNlID0gaWZlbHNlKA0KICAgICAgICAgICAgcm9sZSA9PSAidHJlbmRzZXR0ZXIiLA0KICAgICAgICAgICAgcmF0aW9uYWxfY2hvaWNlLA0KICAgICAgICAgICAgaWZlbHNlKA0KICAgICAgICAgICAgICBjaG9pY2VfcnVsZSA9PSAiZGV0ZXJtaW5pc3RpYyIsDQogICAgICAgICAgICAgIHJhdGlvbmFsX2Nob2ljZSwNCiAgICAgICAgICAgICAgaWZlbHNlKGVycm9yICYgcmF0aW9uYWxfY2hvaWNlID09IDEsIDAsIHJhdGlvbmFsX2Nob2ljZSkNCiAgICAgICAgICAgICkNCiAgICAgICAgICApDQogICAgICAgICkgDQogICAgfQ0KICAgIA0KICAgICMgcmVjb3JkIGRlY2lzaW9ucw0KICAgIGRlY2lzaW9uX2hpc3RvcnkgPC0gYmluZF9yb3dzKGRlY2lzaW9uX2hpc3RvcnksIGFnZW50cyAlPiUgbXV0YXRlKHJvdW5kID0gdCkpDQogICAgY3Vycl9hZG9wdGlvbiA8LSBtZWFuKGFnZW50cyRjaG9pY2UgPT0gMSkNCiAgICBhZG9wdGlvbl9oaXN0b3J5IDwtIGMoYWRvcHRpb25faGlzdG9yeSwgY3Vycl9hZG9wdGlvbikNCiAgICANCiAgICAjIGVxdWlsaWJyaXVtIGxvZ2ljDQogICAgaWYgKHQgPiAxKSB7DQogICAgICBwcmV2X2Fkb3B0aW9uIDwtIGFkb3B0aW9uX2hpc3RvcnlbdCAtIDFdDQogICAgICANCiAgICAgIGlmIChjaG9pY2VfcnVsZSA9PSAiZGV0ZXJtaW5pc3RpYyIpIHsNCiAgICAgICAgaWYgKCFpcy5uYShwcmV2X2Fkb3B0aW9uKSAmJiBhYnMoY3Vycl9hZG9wdGlvbiAtIHByZXZfYWRvcHRpb24pID09IDApIHsNCiAgICAgICAgICBlcXVpbGlicml1bV9yZWFjaGVkIDwtIFRSVUUNCiAgICAgICAgICBlcXVpbGlicml1bV90IDwtIHQgLSAxDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoY2hvaWNlX3J1bGUgPT0gInByb2JhYmlsaXN0aWMiKSB7DQogICAgICAgIA0KICAgICAgICBpZiAodCA+PSBzdGFibGVfd2luZG93ICsgMSkgew0KICAgICAgICAgIHJlY2VudF93aW5kb3cgPC0gdGFpbChhZG9wdGlvbl9oaXN0b3J5LCBzdGFibGVfd2luZG93KQ0KICAgICAgICAgIGlmIChzZChyZWNlbnRfd2luZG93KSA8IHN0YWJsZV90aHJlc2hvbGQpIHsNCiAgICAgICAgICAgIHN0YWJsZV9yb3VuZHMgPC0gc3RhYmxlX3JvdW5kcyArIDENCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc3RhYmxlX3JvdW5kcyA8LSAwDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChzdGFibGVfcm91bmRzID49IHJlcXVpcmVkX3N0YWJsZV9yb3VuZHMpIHsNCiAgICAgICAgICAgIGVxdWlsaWJyaXVtX3JlYWNoZWQgPC0gVFJVRQ0KICAgICAgICAgICAgZXF1aWxpYnJpdW1fdCA8LSB0DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHQgPC0gdCArIDENCiAgfQ0KICBmaW5hbF9yb3VuZCA8LSB0IC0gMQ0KICANCiAgIyBiYXNlZCBvbiBkZWNpc2lvbl9oaXN0b3J5Og0KICAjIDEuIGNhbGN1bGF0ZSBnbG9iYWwgbWFqb3JpdHkgaWxsdXNpb24gb3ZlciByb3VuZHMNCiAgZ2xvYk1JIDwtIG51bWVyaWMoZmluYWxfcm91bmQpDQogIGZvciAodCBpbiAxOmZpbmFsX3JvdW5kKSB7DQogICAgaWYgKHQgPT0gMSkgew0KICAgICAgIyBpbiByb3VuZCAxOiBubyBzb2NpYWwgaW5mb3JtYXRpb24sIHNvIG5vIE1JDQogICAgICBnbG9iTUlbdF0gPC0gTkENCiAgICB9IGVsc2Ugew0KICAgICAgIyByb3VuZHMgdCA+IDE6IGNhbGN1bGF0ZSBtYWduaXR1ZGUgb2YgbWFqb3JpdHkgaWxsdXNpb24NCiAgICAgICMgZmlyc3QsIG1ha2UgYSBjb3B5IG9mIHRoZSBuZXR3b3JrIG9iamVjdA0KICAgICAgZXhwb3N1cmVfbmV0d29yayA8LSBuZXR3b3JrDQogICAgICAjIHVwZGF0ZSB0aGUgYWN0aW9ucyBvZiBhY3RvcnMsIGJhc2VkIG9uIHRoZWlyIGNob2ljZXMgaW4gdGhlIHByZXZpb3VzIHJvdW5kDQogICAgICAjIGFmdGVyIGFsbCwgYWN0b3JzIGRvbid0IG9ic2VydmUgb3RoZXJzJyByb2xlcywgYnV0IG9ubHkgdGhlaXIgY2hvaWNlcywNCiAgICAgICMgYmFzZWQgb24gd2hpY2ggdGhleSBjYW4gaW5mZXIgdGhlaXIgcm9sZQ0KICAgICAgVihleHBvc3VyZV9uZXR3b3JrKSRhY3Rpb24gPC0gZGVjaXNpb25faGlzdG9yeVtkZWNpc2lvbl9oaXN0b3J5JHJvdW5kID09IHQgLSAxLF0kY2hvaWNlDQogICAgICBnbG9iTUlbdF0gPC0gZmNhbGN1bGF0ZV9tYWpvcml0eV9pbGx1c2lvbihleHBvc3VyZV9uZXR3b3JrLCB0aHJlc2hvbGQgPSBtaV90aHJlc2hvbGQpICANCiAgICB9DQogIH0NCiAgDQogICMgdG8gbG9uZyBmb3JtYXQNCiAgTUkgPC0gdGliYmxlKA0KICAgIHJvdW5kID0gMTpmaW5hbF9yb3VuZCwNCiAgICBvdXRjb21lID0gIm1ham9yaXR5X2lsbHVzaW9uIiwNCiAgICBzdGF0aXN0aWMgPSBnbG9iTUkNCiAgKQ0KICANCiAgIyAyLiBjYWxjdWxhdGUgdGhlIGV2b2x1dGlvbiBvZiB0aGUgdW5wb3B1bGFyIG5vcm0NCiAgVU4gPC0gZGVjaXNpb25faGlzdG9yeSAlPiUNCiAgICBncm91cF9ieShyb3VuZCkgJT4lDQogICAgc3VtbWFyaXNlKA0KICAgICAgZm9sbG93X3RyZW5kID0gbWVhbihjaG9pY2UgPT0gMSwgbmEucm0gPSBUUlVFKQ0KICAgICkgJT4lDQogICAgcGl2b3RfbG9uZ2VyKGNvbHMgPSBjKCJmb2xsb3dfdHJlbmQiKSwNCiAgICAgICAgICAgICAgICAgbmFtZXNfdG8gPSAib3V0Y29tZSIsDQogICAgICAgICAgICAgICAgIHZhbHVlc190byA9ICJzdGF0aXN0aWMiKQ0KICANCiAgIyBiaW5kDQogIHBsb3RkYXRhIDwtIGJpbmRfcm93cyhNSSwgVU4pDQogIA0KICBpZiAocGxvdCkgew0KICAgIGZpZyA8LSBnZ3Bsb3QocGxvdGRhdGEsIGFlcyh4ID0gcm91bmQsIHkgPSBzdGF0aXN0aWMsIGNvbG9yID0gZmFjdG9yKG91dGNvbWUpKSkgKw0KICAgICAgZ2VvbV9saW5lKCkgKw0KICAgICAgZ2VvbV9wb2ludCgpICsNCiAgICAgIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OnBlcmNlbnRfZm9ybWF0KHNjYWxlID0gMTAwKSwgbGltaXRzID0gYygwLCAxKSkgKw0KICAgICAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IHNlcSgxLCBtYXgocGxvdGRhdGEkcm91bmQpLCBieSA9IDEpKSArDQogICAgICBsYWJzKA0KICAgICAgICB0aXRsZSA9ICJFdm9sdXRpb24gb2YgYW4gdW5wb3B1bGFyIG5vcm0iLA0KICAgICAgICBzdWJ0aXRsZSA9ICJgZm9sbG93X3RyZW5kYCBkZW5vdGVzIHRoZSBwZXJjZW50YWdlIG9mIGFsbCBhZ2VudHMgdGhhdCBmb2xsb3cgdGhlIHRyZW5kLlxuYG1ham9yaXR5X2lsbHVzaW9uYCByZWZsZWN0cyB0aGUgcGVyY2VudGFnZSBvZiBjb25mb3JtaXN0cyB3aG9zZSBuZWlnaGJvcnMgbWVldCBvciBleGNlZWQgdGhlIGFkb3B0aW9uIHRocmVzaG9sZCDPhiAoaS5lLiwgMC41MCksXG53aXRoICdzdHJvbmcgaW5mbHVlbmNlJyByZWZlcnJpbmcgdG8gYm90aCBtZWV0aW5nIGFuZCBleGNlZWRpbmcgdGhlIHRocmVzaG9sZCwgYW5kICd3ZWFrIGluZmx1ZW5jZScgdG8gZXhjZWVkaW5nIGl0IG9ubHkuXG5UaGUgZ3JleSBkYXNoZWQgbGluZSByZWZsZWN0cyB0aGUgcGVyY2VudGFnZSBvZiBhZ2VudHMgd2hvc2Ugcm9sZSBpcyB0cmVuZHNldHRlci4gVGhlIHB1cnBsZSBjaXJjbGUgKGRldGVybWluaXN0aWMpXG5vciBzaGFkZWQgcHVycGxlIHJlZ2lvbiAocHJvYmFiaWxpc3RpYykgaW5kaWNhdGVzIHRoZSBlcXVpbGlicml1bS4iLA0KICAgICAgICB4ID0gInJvdW5kIiwNCiAgICAgICAgeSA9ICIlIGFnZW50cyIsDQogICAgICAgIGNvbG9yID0gIm91dGNvbWUiDQogICAgICApICsNCiAgICAgIHRoZW1lKA0KICAgICAgICBwYW5lbC5ncmlkLm1pbm9yLnggPSBlbGVtZW50X2JsYW5rKCksDQogICAgICAgICMgbGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIsDQogICAgICAgIHBsb3Quc3VidGl0bGUgPSBlbGVtZW50X3RleHQoc2l6ZSA9IDgpDQogICAgICApICsNCiAgICAgIGdlb21faGxpbmUoDQogICAgICAgIHlpbnRlcmNlcHQgPSBwcm9wLnRhYmxlKHRhYmxlKGFnZW50cyRyb2xlKSlbMl0sDQogICAgICAgIGxpbmV0eXBlID0gImRhc2hlZCIsDQogICAgICAgIGNvbG9yID0gImRhcmtncmV5IiwNCiAgICAgICAgc2l6ZSA9IDENCiAgICAgICkNCiAgICANCiAgICAjIGFkZCBhIGNpcmNsZSBhcm91bmQgdGhlIGVxdWlsaWJyaXVtIHN0YXRlICdmb2xsb3dfdHJlbmQnIHN0YXRpc3RpYw0KICAgICMgb25seSBmb3IgdGhlIGRldGVybWluaXN0aWMgbW9kZWwgKHRydWUgcG9pbnQgZXF1aWxpYnJpdW0pDQogICAgaWYgKCFpcy5uYShlcXVpbGlicml1bV90KSAmJiBjaG9pY2VfcnVsZSA9PSAiZGV0ZXJtaW5pc3RpYyIpIHsNCiAgICAgIGZpZyA8LSBmaWcgKyBnZW9tX3BvaW50KA0KICAgICAgICBkYXRhID0gcGxvdGRhdGEgJT4lIGRwbHlyOjpmaWx0ZXIocm91bmQgPT0gZXF1aWxpYnJpdW1fdCAmIG91dGNvbWUgPT0gImZvbGxvd190cmVuZCIpLA0KICAgICAgICBhZXMoeCA9IHJvdW5kLCB5ID0gc3RhdGlzdGljKSwNCiAgICAgICAgc2hhcGUgPSAxLCBzaXplID0gNCwgY29sb3IgPSAicHVycGxlIiwgc3Ryb2tlID0gMg0KICAgICAgKQ0KICAgIH0NCiAgICANCiAgICAjIGhpZ2hsaWdodCBlcXVpbGlicml1bSByZWdpb24gZm9yIHByb2JhYmlsaXN0aWMgbW9kZWwgKHN0YWJsZSB3aW5kb3cpDQogICAgaWYgKCFpcy5uYShlcXVpbGlicml1bV90KSAmJiBjaG9pY2VfcnVsZSA9PSAicHJvYmFiaWxpc3RpYyIgJiYgZmluYWxfcm91bmQgPj0gc3RhYmxlX3dpbmRvdykgew0KICAgICAgIyBlcXVpbGlicml1bV90IGlzIHRoZSBsYXN0IHJvdW5kIGF0IHdoaWNoIGVxdWlsaWJyaXVtIHdhcyBkZXRlY3RlZA0KICAgICAgZXFfZW5kICAgPC0gZXF1aWxpYnJpdW1fdA0KICAgICAgZXFfc3RhcnQgPC0gbWF4KDEsIGVxdWlsaWJyaXVtX3QgLSBzdGFibGVfd2luZG93ICsgMSkNCiAgICAgIA0KICAgICAgZmlnIDwtIGZpZyArDQogICAgICAgIGFubm90YXRlKA0KICAgICAgICAgICJyZWN0IiwNCiAgICAgICAgICB4bWluID0gZXFfc3RhcnQgLSAwLjUsDQogICAgICAgICAgeG1heCA9IGVxX2VuZCArIDAuNSwNCiAgICAgICAgICB5bWluID0gLUluZiwNCiAgICAgICAgICB5bWF4ID0gSW5mLA0KICAgICAgICAgIGFscGhhID0gMC4wNSwNCiAgICAgICAgICBmaWxsID0gInB1cnBsZSINCiAgICAgICAgKQ0KICAgICAgIyBubyBleHRyYSBwb2ludHMgaGVyZTsgdGhlIGJhbmQgYWxvbmUgcmVwcmVzZW50cyBzdG9jaGFzdGljIGVxdWlsaWJyaXVtDQogICAgfQ0KICB9DQogIA0KICBpZiAoIWlzLm5hKGVxdWlsaWJyaXVtX3QpKSB7DQogICAgIyBnZXQgYWdlbnRzJyBiZWhhdmlvcnMgYXQgZXF1aWxpYnJpdW0NCiAgICBmaW5hbF9jaG9pY2VzIDwtIGRlY2lzaW9uX2hpc3RvcnkgJT4lDQogICAgICBmaWx0ZXIocm91bmQgPT0gZXF1aWxpYnJpdW1fdCkgJT4lDQogICAgICBhcnJhbmdlKGlkKSAlPiUNCiAgICAgIHB1bGwoY2hvaWNlKQ0KICAgIA0KICAgICMgYXR0YWNoIHRvIHRoZSBuZXR3b3JrDQogICAgVihuZXR3b3JrKSRmaW5hbF9jaG9pY2UgPC0gZmluYWxfY2hvaWNlcw0KICAgIA0KICAgICMgYmVoYXZpb3JhbCBhc3NvcnRhdGl2aXR5DQogICAgcl9iZWhhdmlvciA8LSBpZ3JhcGg6OmFzc29ydGF0aXZpdHlfbm9taW5hbChuZXR3b3JrLCB0eXBlcyA9IGZpbmFsX2Nob2ljZXMgKyAxLCBkaXJlY3RlZCA9IEZBTFNFKQ0KICAgIA0KICAgICMgTDFDQyBzaGFyZQ0KICAgIFMxIDwtIHdoaWNoKGZpbmFsX2Nob2ljZXMgPT0gMSkNCiAgICBMMUNDX3NoYXJlIDwtIGlmIChsZW5ndGgoUzEpID09IDApIE5BX3JlYWxfIGVsc2Ugew0KICAgICAgZzEgPC0gaWdyYXBoOjppbmR1Y2VkX3N1YmdyYXBoKG5ldHdvcmssIFMxKQ0KICAgICAgY2MgPC0gaWdyYXBoOjpjb21wb25lbnRzKGcxKSRjc2l6ZQ0KICAgICAgbWF4KGNjKSAvIGxlbmd0aChTMSkNCiAgICB9DQogICAgc2VncmVnYXRpb24gPC0gbGlzdChyX2JlaGF2aW9yID0gcl9iZWhhdmlvciwgTDFDQ19zaGFyZSA9IEwxQ0Nfc2hhcmUpDQogIH0gZWxzZSB7DQogICAgc2VncmVnYXRpb24gPC0gbGlzdChyX2JlaGF2aW9yID0gTkEsIEwxQ0Nfc2hhcmUgPSBOQSkNCiAgfQ0KICANCiAgIyByZXR1cm4gb3V0cHV0cw0KICBvdXRwdXQgPC0gbGlzdCgpDQogIGlmIChoaXN0b3JpZXMpIHsgDQogICAgb3V0cHV0JGRlY2lzaW9uX2hpc3RvcnkgPC0gZGVjaXNpb25faGlzdG9yeQ0KICB9DQogIA0KICBpZiAob3V0Y29tZSkgeyANCiAgICBvdXRwdXQkb3V0Y29tZXMgPC0gcGxvdGRhdGENCiAgICBvdXRwdXQkZXF1aWxpYnJpdW0gPC0gbGlzdCgNCiAgICAgIHJlYWNoZWQgPSBlcXVpbGlicml1bV9yZWFjaGVkLA0KICAgICAgcm91bmQgPSBlcXVpbGlicml1bV90LA0KICAgICAgcHJvcF9mb2xsb3dfdHJlbmQgPSBpZiAoIWlzLm5hKGVxdWlsaWJyaXVtX3QpKSB7DQogICAgICAgIG1lYW4oDQogICAgICAgICAgZGVjaXNpb25faGlzdG9yeSAlPiUNCiAgICAgICAgICAgIGRwbHlyOjpmaWx0ZXIocm91bmQgPT0gZXF1aWxpYnJpdW1fdCkgJT4lDQogICAgICAgICAgICBkcGx5cjo6cHVsbChjaG9pY2UpID09IDENCiAgICAgICAgKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgTkFfcmVhbF8NCiAgICAgIH0sDQogICAgICBzZWdyZWdhdGlvbiA9IHNlZ3JlZ2F0aW9uDQogICAgKQ0KICB9DQogIA0KICBpZiAocGxvdCkgeyANCiAgICBvdXRwdXQkcGxvdCA8LSBmaWcNCiAgfQ0KICANCiAgcmV0dXJuKG91dHB1dCkNCn0NCg0KIyBmdW5jdGlvbiB0byBjcmVhdGUgYSBwbG90IGRpc3BsYXlpbmcgdGhlIG91dHB1dHMgKCUgbm9ybSBmb2xsb3dlcnMpIGFjcm9zcyBzaW11bGF0ZWQgbmV0d29ya3MNCmZjcmVhdGVfb3V0Y29tZV9wbG90IDwtIGZ1bmN0aW9uKHBfdF9sZXZlbCkgew0KICBkYXRhX2ZpbHRlcmVkIDwtIGRhdGEgJT4lIGZpbHRlcihwX3QgPT0gcF90X2xldmVsKQ0KICANCiAgZ2dwbG90KGRhdGFfZmlsdGVyZWQsIGFlcyh4ID0gYWN0dWFsX3JobywgeSA9IGFjdHVhbF9yLCBjb2xvciA9IHByb3BfdHJlbmQpKSArDQogICAgZ2VvbV9wb2ludChzaXplID0gMS41LCBhbHBoYSA9IDAuNykgKw0KICAgIGZhY2V0X2dyaWQyKA0KICAgICAgcm93cyA9IHZhcnMoZGlzdCksDQogICAgICBjb2xzID0gdmFycyhhbHBoYSksDQogICAgICBsYWJlbGxlciA9IGxhYmVsbGVyKGFscGhhID0gZnVuY3Rpb24oeCkgcGFzdGUwKCJcdTAzQjE9IiwgeCkpDQogICAgKSArDQogICAgc2NhbGVfY29sb3JfZ3JhZGllbnRuKA0KICAgICAgY29sb3JzID0gYygibGlnaHRibHVlIiwgInllbGxvdyIsICJyZWQiLCAiYmxhY2siKSwNCiAgICAgIHZhbHVlcyA9IHNjYWxlczo6cmVzY2FsZShjKDAsIDAuMiwgMC41LCAwLjc1LCAwLjksIDEpKSwNCiAgICAgIGxpbWl0cyA9IGMoMCwgMSksDQogICAgICBuYW1lID0gIiUgYWdlbnRzXG5mb2xsb3dpbmcifml0YWxpYyhCKX4iIg0KICAgICkgKw0KICAgIGxhYnMoDQogICAgICB4ID0gZXhwcmVzc2lvbihyaG9ba3hdKSwNCiAgICAgIHkgPSBleHByZXNzaW9uKHJba2tdKSwNCiAgICAgIHRpdGxlID0gcGFzdGUoInByb3BvcnRpb24gbWlub3JpdHkgPSIsIHBfdF9sZXZlbCkNCiAgICApICsNCiAgICB0aGVtZV9taW5pbWFsKCkgKw0KICAgIHRoZW1lKA0KICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfcmVjdChmaWxsID0gImdyZXk5MCIsIGNvbG9yID0gImdyZXk1MCIpDQogICAgKQ0KfQ0KDQojIGZ1bmN0aW9uIHRvIGRpc3BsYXkgYWdncmVnYXRlZCBvdXRjb21lcyAocHJvYmFiaWxpdHkgb2YgYSBuZWdhdGl2ZSBjYXNjYWRlKSBhY3Jvc3MgdGhlIHBhcmFtZXRlciBzcGFjZQ0KZmNyZWF0ZV9oZWF0bWFwIDwtIGZ1bmN0aW9uKGRhdGEsIGNob2ljZV9ydWxlLCBtaW5vcml0eV9wcm9wLCBrbWluLCBrbWF4LCBpbmZsdWVuY2UpIHsNCiAgDQogIGRhdGFfZmlsdGVyZWQgPC0gZGF0YSAlPiUNCiAgICBmaWx0ZXIoDQogICAgICBtaW5vcml0eV9wcm9wID09ICEhbWlub3JpdHlfcHJvcCwNCiAgICAgIGNob2ljZV9ydWxlID09ICEhY2hvaWNlX3J1bGUsDQogICAgICBtaW5fZGVnID09ICEha21pbiwNCiAgICAgIG1heF9kZWcgPT0gISFrbWF4LA0KICAgICAgaW5mbHVlbmNlID09ICEhaW5mbHVlbmNlDQogICAgKQ0KICANCiAgZGF0YV9zdW1tYXJ5IDwtIGRhdGFfZmlsdGVyZWQgJT4lDQogICAgZ3JvdXBfYnkodGFyZ2V0X3JobywgdGFyZ2V0X3IsIGFscGhhLCBkaXN0KSAlPiUNCiAgICBzdW1tYXJpemUoDQogICAgICBgUChuZWcuIGNhc2NhZGUpYCA9IG1lYW4odW5wb3AgPT0gMSwgbmEucm0gPSBUUlVFKSwNCiAgICAgIG4gPSBuKCksDQogICAgICAuZ3JvdXBzID0gImRyb3AiDQogICAgKQ0KICANCiAgbWF4X3ZhbHVlcyA8LSBkYXRhX3N1bW1hcnkgJT4lDQogICAgZ3JvdXBfYnkoYWxwaGEsIGRpc3QpICU+JQ0KICAgIGZpbHRlcihgUChuZWcuIGNhc2NhZGUpYCA9PSBtYXgoYFAobmVnLiBjYXNjYWRlKWApKSAlPiUNCiAgICBkaXN0aW5jdChhbHBoYSwgZGlzdCwgLmtlZXBfYWxsID0gVFJVRSkgJT4lDQogICAgdW5ncm91cCgpDQogIA0KICBnZ3Bsb3QoZGF0YV9zdW1tYXJ5LCBhZXMoeCA9IHRhcmdldF9yaG8sIHkgPSB0YXJnZXRfciwgZmlsbCA9IGBQKG5lZy4gY2FzY2FkZSlgKSkgKw0KICAgIGdlb21fdGlsZShjb2xvciA9ICJ3aGl0ZSIpICsNCiAgICBzY2FsZV9maWxsX2dyYWRpZW50bigNCiAgICAgIGNvbG9ycyA9IGMoImxpZ2h0Ymx1ZSIsICJ5ZWxsb3ciLCAib3JhbmdlIiwgInJlZCIpLCANCiAgICAgIG5hbWUgPSAiUChuZWcuIGNhc2NhZGUpIiwNCiAgICAgIGxpbWl0cyA9IGMoMCwgMSkNCiAgICApICsNCiAgICBmYWNldF9ncmlkMigNCiAgICAgIHJvd3MgPSB2YXJzKGRpc3QpLA0KICAgICAgY29scyA9IHZhcnMoYWxwaGEpLA0KICAgICAgc2NhbGVzID0gImZyZWUiLA0KICAgICAgaW5kZXBlbmRlbnQgPSBUUlVFLA0KICAgICAgbGFiZWxsZXIgPSBsYWJlbGxlcihhbHBoYSA9IGZ1bmN0aW9uKHgpIHBhc3RlMCgiXHUwM0IxPSIsIHgpKQ0KICAgICkgKw0KICAgIGxhYnMoDQogICAgICB4ID0gZXhwcmVzc2lvbihyaG9ba3hdKSwgDQogICAgICB5ID0gZXhwcmVzc2lvbihyW2trXSksIA0KICAgICAgdGl0bGUgPSBwYXN0ZSgiUHJvcG9ydGlvbiBtaW5vcml0aWVzID0iLCBtaW5vcml0eV9wcm9wKQ0KICAgICkgKw0KICAgIHRoZW1lX21pbmltYWwoKSArDQogICAgdGhlbWUoDQogICAgICBzdHJpcC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAiZ3JleTkwIiwgY29sb3IgPSAiZ3JleTUwIiksDQogICAgICBsZWdlbmQucG9zaXRpb24gPSAicmlnaHQiDQogICAgKQ0KfQ0KDQpmY3JlYXRlX2hlYXRtYXBfc3cgPC0gZnVuY3Rpb24oZGF0YSwgY2hvaWNlX3J1bGUsIG1pbm9yaXR5X3Byb3AsIGluZmx1ZW5jZSkgew0KICANCiAgZGF0YV9maWx0ZXJlZCA8LSBkYXRhICU+JQ0KICAgIGZpbHRlcigNCiAgICAgIG1pbm9yaXR5X3Byb3AgPT0gISFtaW5vcml0eV9wcm9wLA0KICAgICAgY2hvaWNlX3J1bGUgPT0gISFjaG9pY2VfcnVsZSwNCiAgICAgIGluZmx1ZW5jZSA9PSAhIWluZmx1ZW5jZQ0KICAgICkNCiAgDQogIGRhdGFfc3VtbWFyeSA8LSBkYXRhX2ZpbHRlcmVkICU+JQ0KICAgIGdyb3VwX2J5KHRhcmdldF9yaG8sIHRhcmdldF9yLCBtaW5fZGVnLCBwKSAlPiUNCiAgICBzdW1tYXJpemUoDQogICAgICBgUChuZWcuIGNhc2NhZGUpYCA9IG1lYW4odW5wb3AgPT0gMSwgbmEucm0gPSBUUlVFKSwNCiAgICAgIG4gPSBuKCksDQogICAgICAuZ3JvdXBzID0gImRyb3AiDQogICAgKQ0KICANCiAgZ2dwbG90KGRhdGFfc3VtbWFyeSwgYWVzKHggPSB0YXJnZXRfcmhvLCB5ID0gdGFyZ2V0X3IsIGZpbGwgPSBgUChuZWcuIGNhc2NhZGUpYCkpICsNCiAgICBnZW9tX3RpbGUoY29sb3IgPSAid2hpdGUiKSArDQogICAgc2NhbGVfZmlsbF9ncmFkaWVudG4oDQogICAgICBjb2xvcnMgPSBjKCJsaWdodGJsdWUiLCAieWVsbG93IiwgIm9yYW5nZSIsICJyZWQiKSwgDQogICAgICBuYW1lID0gIlAobmVnLiBjYXNjYWRlKSIsDQogICAgICBsaW1pdHMgPSBjKDAsIDEpDQogICAgKSArDQogICAgZmFjZXRfZ3JpZDIoDQogICAgICByb3dzID0gdmFycyhtaW5fZGVnKSwgICANCiAgICAgIGNvbHMgPSB2YXJzKHApLCAgICAgICAgIA0KICAgICAgc2NhbGVzID0gImZyZWUiLA0KICAgICAgaW5kZXBlbmRlbnQgPSBUUlVFLA0KICAgICAgbGFiZWxsZXIgPSBsYWJlbGxlcigNCiAgICAgICAgbWluX2RlZyA9IGZ1bmN0aW9uKHgpIHBhcnNlKHRleHQgPSBwYXN0ZTAoImtfbWluID0gIiwgeCkpLA0KICAgICAgICBwID0gZnVuY3Rpb24oeCkgcGFyc2UodGV4dCA9IHBhc3RlMCgicCA9ICIsIHgpKQ0KICAgICAgKQ0KICAgICkgKw0KICAgIGxhYnMoDQogICAgICB4ID0gZXhwcmVzc2lvbihyaG9ba3hdKSwgDQogICAgICB5ID0gZXhwcmVzc2lvbihyW2trXSksIA0KICAgICAgdGl0bGUgPSBwYXN0ZSgiUHJvcG9ydGlvbiBtaW5vcml0aWVzID0iLCBtaW5vcml0eV9wcm9wKQ0KICAgICkgKw0KICAgIHRoZW1lX21pbmltYWwoKSArDQogICAgdGhlbWUoDQogICAgICBzdHJpcC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAiZ3JleTkwIiwgY29sb3IgPSAiZ3JleTUwIiksDQogICAgICBsZWdlbmQucG9zaXRpb24gPSAicmlnaHQiDQogICAgKQ0KfQ0KDQpmY3JlYXRlX2hlYXRtYXAyIDwtIGZ1bmN0aW9uKGRhdGEsIGNob2ljZV9ydWxlLCBtaW5vcml0eV9wcm9wLCBrbWluLCBpbmZsdWVuY2UpIHsNCiAgDQogICMgZmlsdGVyIGRhdGENCiAgZGF0YV9maWx0ZXJlZCA8LSBkYXRhICU+JQ0KICAgIGZpbHRlcigNCiAgICAgIG1pbm9yaXR5X3Byb3AgPT0gISFtaW5vcml0eV9wcm9wLA0KICAgICAgY2hvaWNlX3J1bGUgPT0gISFjaG9pY2VfcnVsZSwNCiAgICAgIG1pbl9kZWcgPT0gISFrbWluLA0KICAgICAgaW5mbHVlbmNlID09ICEhaW5mbHVlbmNlDQogICAgKQ0KICANCiAgIyBzdW1tYXJpemUgZGF0YQ0KICBkYXRhX3N1bW1hcnkgPC0gZGF0YV9maWx0ZXJlZCAlPiUNCiAgICBncm91cF9ieSh0YXJnZXRfcmhvLCB0YXJnZXRfciwgYWxwaGEsIGRpc3QpICU+JQ0KICAgIHN1bW1hcml6ZSgNCiAgICAgIG1lYW5fYiA9IG1lYW4oZmluYWxfYWRvcHRpb25fcmF0ZSwgbmEucm0gPSBUUlVFKSwNCiAgICAgIHNkX2IgPSBzZChmaW5hbF9hZG9wdGlvbl9yYXRlLCBuYS5ybSA9IFRSVUUpIC8gc3FydChuKCkpLA0KICAgICAgbiA9IG4oKSwNCiAgICAgIC5ncm91cHMgPSAiZHJvcCINCiAgICApDQogIA0KICAjIENyZWF0ZSBoZWF0bWFwIHdpdGggb3ZlcmxhaWQgcG9pbnQgc2hvd2luZyBTRA0KICBnZ3Bsb3QoZGF0YV9zdW1tYXJ5LCBhZXMoeCA9IHRhcmdldF9yaG8sIHkgPSB0YXJnZXRfcikpICsNCiAgICBnZW9tX3RpbGUoYWVzKGZpbGwgPSBtZWFuX2IpLCBjb2xvciA9ICJ3aGl0ZSIpICsNCiAgICBnZW9tX3BvaW50KGFlcyhzaXplID0gc2RfYiksIGNvbG9yID0gImJsYWNrIiwgYWxwaGEgPSAwLjcpICsNCiAgICBzY2FsZV9maWxsX2dyYWRpZW50bigNCiAgICAgIGNvbG9ycyA9IGMoImxpZ2h0Ymx1ZSIsICJ5ZWxsb3ciLCAib3JhbmdlIiwgInJlZCIpLA0KICAgICAgbmFtZSA9ICJNZWFuICUgQWRvcHRpbmciLA0KICAgICAgbGltaXRzID0gYygwLCAxKQ0KICAgICkgKw0KICAgIHNjYWxlX3NpemVfY29udGludW91cygNCiAgICAgIG5hbWUgPSAiU0UiLA0KICAgICAgcmFuZ2UgPSBjKDAuMSwgMikgICMgYWRqdXN0IHNpemUgcmFuZ2UgdG8geW91ciBsaWtpbmcNCiAgICApICsNCiAgICBmYWNldF9ncmlkMigNCiAgICAgIHJvd3MgPSB2YXJzKGRpc3QpLA0KICAgICAgY29scyA9IHZhcnMoYWxwaGEpLA0KICAgICAgc2NhbGVzID0gImZyZWUiLA0KICAgICAgaW5kZXBlbmRlbnQgPSBUUlVFLA0KICAgICAgbGFiZWxsZXIgPSBsYWJlbGxlcihhbHBoYSA9IGZ1bmN0aW9uKHgpIHBhc3RlMCgiXHUwM0IxPSIsIHgpKQ0KICAgICkgKw0KICAgIGxhYnMoDQogICAgICB4ID0gZXhwcmVzc2lvbihyaG9ba3hdKSwNCiAgICAgIHkgPSBleHByZXNzaW9uKHJba2tdKSwNCiAgICAgIHRpdGxlID0gcGFzdGUoIlByb3BvcnRpb24gbWlub3JpdGllcyA9IiwgbWlub3JpdHlfcHJvcCkNCiAgICApICsNCiAgICB0aGVtZV9taW5pbWFsKCkgKw0KICAgIHRoZW1lKA0KICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfcmVjdChmaWxsID0gImdyZXk5MCIsIGNvbG9yID0gImdyZXk1MCIpLA0KICAgICAgbGVnZW5kLnBvc2l0aW9uID0gInJpZ2h0Ig0KICAgICkNCn0NCg0KZm91dGNvbWVzIDwtIGZ1bmN0aW9uKGRhdGEsIGNob2ljZV9ydWxlLCBtaW5vcml0eV9wcm9wLCBrbWluLCBpbmZsdWVuY2UpIHsNCiAgDQogICMgZmlsdGVyIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnB1dA0KICBkZl9maWx0ZXJlZCA8LSBkYXRhICU+JQ0KICAgIGZpbHRlcigNCiAgICAgIG1pbm9yaXR5X3Byb3AgPT0gISFtaW5vcml0eV9wcm9wLA0KICAgICAgY2hvaWNlX3J1bGUgPT0gISFjaG9pY2VfcnVsZSwNCiAgICAgIG1pbl9kZWcgPT0gISFrbWluLA0KICAgICAgaW5mbHVlbmNlID09ICEhaW5mbHVlbmNlDQogICAgKQ0KICANCiAgDQogIA0KICBmaWcxIDwtIHBsb3RfbHkoKQ0KICBmb3IgKGRpc3QgaW4gdW5pcXVlKGRmX2ZpbHRlcmVkJGRpc3QpKSB7DQogICAgZmlnMSA8LSBmaWcxICU+JQ0KICAgICAgYWRkX3RyYWNlKA0KICAgICAgICBkYXRhID0gZGZfZmlsdGVyZWRbZGZfZmlsdGVyZWQkZGlzdCA9PSBkaXN0LCBdLA0KICAgICAgICB4ID0gfmFscGhhLA0KICAgICAgICB5ID0gfmFjdHVhbF9yaG8sDQogICAgICAgIHogPSB+YWN0dWFsX3IsDQogICAgICAgIGNvbG9yID0gfmZpbmFsX2Fkb3B0aW9uX3JhdGUsDQogICAgICAgIHR5cGUgPSAnc2NhdHRlcjNkJywNCiAgICAgICAgbW9kZSA9ICdtYXJrZXJzJywNCiAgICAgICAgbWFya2VyID0gbGlzdChzaXplID0gMyksDQogICAgICAgIG5hbWUgPSBhcy5jaGFyYWN0ZXIoZGlzdCksDQogICAgICAgIGhvdmVydGVtcGxhdGUgPSBwYXN0ZSgNCiAgICAgICAgICAizrE6ICV7eH08YnI+IiwNCiAgICAgICAgICAiz4Ffe3hrfTogJXt5fTxicj4iLA0KICAgICAgICAgICJyX3tra306ICV7en08YnI+IiwNCiAgICAgICAgICAiRmluYWwgQWRvcHRpb24gUmF0ZTogJXttYXJrZXIuY29sb3J9PGV4dHJhPjwvZXh0cmE+Ig0KICAgICAgICApDQogICAgICApDQogIH0NCiAgDQogIGZpZzEgPC0gZmlnMSAlPiUNCiAgICBsYXlvdXQoDQogICAgICB0aXRsZSA9ICczRCBzY2F0dGVycGxvdCBvZiB0aGUgZmluYWwgYWRvcHRpb24gYnkgZGVncmVlIGRpc3RyaWJ1dGlvbiB0eXBlJywNCiAgICAgIHNjZW5lID0gbGlzdCgNCiAgICAgICAgeGF4aXMgPSBsaXN0KHRpdGxlID0gIs6xIiksDQogICAgICAgIHlheGlzID0gbGlzdCh0aXRsZSA9ICLPgV97eGt9IiksDQogICAgICAgIHpheGlzID0gbGlzdCh0aXRsZSA9ICJyX3tra30iKQ0KICAgICAgKQ0KICAgICkgJT4lDQogICAgY29sb3JiYXIodGl0bGU9IiIpDQogIA0KICAjIGZpdCBtb2RlbHMgdXNpbmcgKmZpbHRlcmVkKiBkYXRhDQogICNtMSA8LSBsbShmaW5hbF9hZG9wdGlvbl9yYXRlIH4gYWN0dWFsX3JobyArIGFjdHVhbF9yICsgYXMuZmFjdG9yKGFscGhhKSwgZGF0YSA9IGRmX2ZpbHRlcmVkW2RmX2ZpbHRlcmVkJGRpc3QgPT0gInBvd2VyLWxhdyIsIF0pDQogICNtMiA8LSBsbShmaW5hbF9hZG9wdGlvbl9yYXRlIH4gYWN0dWFsX3JobyArIGFjdHVhbF9yICsgYXMuZmFjdG9yKGFscGhhKSArIGFjdHVhbF9yaG86YWN0dWFsX3IsIGRhdGEgPSBkZl9maWx0ZXJlZFtkZl9maWx0ZXJlZCRkaXN0ID09ICJwb3dlci1sYXciLCBdKQ0KICBtMyA8LSBsbShmaW5hbF9hZG9wdGlvbl9yYXRlIH4gYWN0dWFsX3JobyArIGFjdHVhbF9yICsgYXMuZmFjdG9yKGFscGhhKSArIGFjdHVhbF9yaG86YWN0dWFsX3IgKyBhY3R1YWxfcmhvOmFzLmZhY3RvcihhbHBoYSkgKyBhY3R1YWxfcjphcy5mYWN0b3IoYWxwaGEpLCBkYXRhID0gZGZfZmlsdGVyZWRbZGZfZmlsdGVyZWQkZGlzdCA9PSAicG93ZXItbGF3IiwgXSkNCiAgDQogICMgY3JlYXRlIHNlcXVlbmNlcyBvZiB2YWx1ZXMgZm9yIHJobywgciwgYW5kIGFscGhhIGZvciBwcmVkaWN0aW9ucw0KICByaG9fdmFscyA8LSBzZXEobWluKGRmX2ZpbHRlcmVkW2RmX2ZpbHRlcmVkJGRpc3QgPT0gInBvd2VyLWxhdyIsXSRhY3R1YWxfcmhvKSwgbWF4KGRmX2ZpbHRlcmVkW2RmX2ZpbHRlcmVkJGRpc3QgPT0gInBvd2VyLWxhdyIsXSRhY3R1YWxfcmhvKSwgbGVuZ3RoLm91dCA9IDUwKQ0KICByX3ZhbHMgPC0gc2VxKG1pbihkZl9maWx0ZXJlZFtkZl9maWx0ZXJlZCRkaXN0ID09ICJwb3dlci1sYXciLF0kYWN0dWFsX3IpLCBtYXgoZGZfZmlsdGVyZWRbZGZfZmlsdGVyZWQkZGlzdCA9PSAicG93ZXItbGF3IixdJGFjdHVhbF9yKSwgbGVuZ3RoLm91dCA9IDUwKQ0KICBhbHBoYV92YWxzIDwtIGMoMi4xLCAyLjUsIDMpDQogIA0KICAjIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIHN1cmZhY2UgZGF0YSBiYXNlZCBvbiBwcmVkaWN0aW9ucyBmb3IgZmluYWxfYWRvcHRpb25fcmF0ZQ0KICBmc3VyZmFjZWRhdCA8LSBmdW5jdGlvbihhbHBoYV92YWwpIHsNCiAgICAjIGNyZWF0ZSBhIGdyaWQgb2YgciBhbmQgcmhvIHZhbHVlcw0KICAgIGdyaWQgPC0gZXhwYW5kLmdyaWQoYWN0dWFsX3IgPSByX3ZhbHMsIGFjdHVhbF9yaG8gPSByaG9fdmFscykNCiAgICANCiAgICAjIGFkZCBmaXhlZCBhbHBoYSB2YWx1ZQ0KICAgIGdyaWQkYWxwaGEgPC0gYWxwaGFfdmFsDQogICAgDQogICAgIyBwcmVkaWN0IGZpbmFsX2Fkb3B0aW9uX3JhdGUgdXNpbmcgdGhlIG1vZGVsDQogICAgZ3JpZCRhZG9wdGlvbl9wcmVkIDwtIHByZWRpY3QobTMsIG5ld2RhdGEgPSBncmlkKQ0KICAgIA0KICAgICMgcmVzaGFwZSB0aGUgcHJlZGljdGlvbnMgaW50byBhIG1hdHJpeCBmb3Igc3VyZmFjZSBwbG90dGluZw0KICAgIGFkb3B0aW9uX21hdHJpeCA8LSBtYXRyaXgoZ3JpZCRhZG9wdGlvbl9wcmVkLCBucm93ID0gbGVuZ3RoKHJfdmFscyksIG5jb2wgPSBsZW5ndGgocmhvX3ZhbHMpLCBieXJvdyA9IFRSVUUpDQogICAgDQogICAgcmV0dXJuKGFkb3B0aW9uX21hdHJpeCkNCiAgfQ0KICANCiAgIyBwcmVjb21wdXRlIHRoZSBzdXJmYWNlIGRhdGEgZm9yIGFsbCBhbHBoYSB2YWx1ZXMNCiAgc3VyZmFjZV9kYXRhX2xpc3QgPC0gbGFwcGx5KGFscGhhX3ZhbHMsIGZzdXJmYWNlZGF0KQ0KICANCiAgIyBmaW5kIHRoZSBnbG9iYWwgcmFuZ2Ugb2YgZmluYWxfYWRvcHRpb25fcmF0ZSAoeiB2YWx1ZXMpIGZvciBjb2xvciBzY2FsaW5nDQogIHpfbWluIDwtIG1pbihzYXBwbHkoc3VyZmFjZV9kYXRhX2xpc3QsIG1pbikpDQogIHpfbWF4IDwtIG1heChzYXBwbHkoc3VyZmFjZV9kYXRhX2xpc3QsIG1heCkpDQogIA0KICAjIGNyZWF0ZSB0aGUgaW5pdGlhbCBzdXJmYWNlIHBsb3Qgd2l0aCB0aGUgZmlyc3QgYWxwaGEgdmFsdWUNCiAgZmlnMiA8LSBwbG90X2x5KA0KICAgIHggPSByX3ZhbHMsICAjIHgtYXhpczogcg0KICAgIHkgPSByaG9fdmFscywgICMgeS1heGlzOiByaG8NCiAgICB6ID0gc3VyZmFjZV9kYXRhX2xpc3RbWzFdXSwgICMgc3VyZmFjZSBkYXRhIGZvciB0aGUgZmlyc3QgYWxwaGEgdmFsdWUNCiAgICB0eXBlID0gInN1cmZhY2UiLA0KICAgIGNvbG9yYmFyID0gbGlzdCgNCiAgICAgICN0aXRsZSA9ICJVbnBvcHVsYXIgbm9ybSBmb2xsb3dlcnMgYXQgZXF1aWxpYnJpdW0iLA0KICAgICAgY21pbiA9IHpfbWluLA0KICAgICAgY21heCA9IHpfbWF4DQogICAgKSwNCiAgICBjbWluID0gel9taW4sDQogICAgY21heCA9IHpfbWF4LA0KICAgIGhvdmVydGVtcGxhdGUgPSBwYXN0ZSgNCiAgICAgICJyX3tra306ICV7eDouMmZ9PGJyPiIsDQogICAgICAiz4Ffe3hrfTogJXt5Oi4yZn08YnI+IiwNCiAgICAgICJGaW5hbCBBZG9wdGlvbiBSYXRlOiAle3o6LjJmfTxleHRyYT48L2V4dHJhPiINCiAgICApDQogICkNCiAgDQogICMgYWRkIHNsaWRlciBmb3IgZHluYW1pYyBhbHBoYSBzZWxlY3Rpb24NCiAgZmlnMiA8LSBmaWcyICU+JQ0KICAgIGxheW91dCgNCiAgICAgIHRpdGxlID0gcGFzdGUoJ1ByZWRpY3RlZCB1bnBvcHVsYXIgbm9ybSBjb21wbGlhbmNlIGluIHNjYWxlLWZyZWUgbmV0d29yayBmcm9tIE9MUyBtb2RlbCBmb3IgzrEgPScsIGFscGhhX3ZhbHNbMV0pLA0KICAgICAgc2NlbmUgPSBsaXN0KA0KICAgICAgICB4YXhpcyA9IGxpc3QodGl0bGUgPSAicl97a2t9IiksDQogICAgICAgIHlheGlzID0gbGlzdCh0aXRsZSA9ICLPgV97a3h9IiksDQogICAgICAgIHpheGlzID0gbGlzdCgNCiAgICAgICAgICByYW5nZSA9IGMoel9taW4sIHpfbWF4KQ0KICAgICAgICApDQogICAgICApLA0KICAgICAgc2xpZGVycyA9IGxpc3QoDQogICAgICAgIGxpc3QoDQogICAgICAgICAgYWN0aXZlID0gMCwgDQogICAgICAgICAgc3RlcHMgPSBsYXBwbHkoc2VxX2Fsb25nKGFscGhhX3ZhbHMpLCBmdW5jdGlvbihpKSB7DQogICAgICAgICAgICBsaXN0KA0KICAgICAgICAgICAgICBtZXRob2QgPSAidXBkYXRlIiwNCiAgICAgICAgICAgICAgYXJncyA9IGxpc3QoDQogICAgICAgICAgICAgICAgbGlzdCgNCiAgICAgICAgICAgICAgICAgIHogPSBsaXN0KHN1cmZhY2VfZGF0YV9saXN0W1tpXV0pICANCiAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgIGxpc3QoDQogICAgICAgICAgICAgICAgICB0aXRsZSA9IHBhc3RlKCdQcmVkaWN0ZWQgdW5wb3B1bGFyIG5vcm0gY29tcGxpYW5jZSBpbiBzY2FsZS1mcmVlIG5ldHdvcmsgZnJvbSBPTFMgbW9kZWwgZm9yIM6xID0nLCBhbHBoYV92YWxzW2ldKSANCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICksDQogICAgICAgICAgICAgIGxhYmVsID0gYXMuY2hhcmFjdGVyKGFscGhhX3ZhbHNbaV0pIA0KICAgICAgICAgICAgKQ0KICAgICAgICAgIH0pLA0KICAgICAgICAgIGN1cnJlbnR2YWx1ZSA9IGxpc3QoDQogICAgICAgICAgICBwcmVmaXggPSAizrE6ICIsICANCiAgICAgICAgICAgIGZvbnQgPSBsaXN0KHNpemUgPSAxNikNCiAgICAgICAgICApDQogICAgICAgICkNCiAgICAgICkNCiAgICApDQogIA0KICBsaXN0KGZpZzEgPSBmaWcxLCBmaWcyID0gZmlnMikNCn0NCg0KZndyYXBwZXIgPC0gZnVuY3Rpb24oZGF0YSwgDQogICAgICAgICAgICAgICAgICAgICBjaG9pY2VfcnVsZSwgDQogICAgICAgICAgICAgICAgICAgICBpbmZsdWVuY2UsIA0KICAgICAgICAgICAgICAgICAgICAga21pbiA9IE5VTEwsIA0KICAgICAgICAgICAgICAgICAgICAga21heCA9IE5VTEwsDQogICAgICAgICAgICAgICAgICAgICBtaW5vcml0eV9wcm9wcyA9IGMoMC4wNSwgMC4xLCAwLjE1KSwNCiAgICAgICAgICAgICAgICAgICAgIGZwbG90ID0gZmNyZWF0ZV9oZWF0bWFwKSB7DQogIA0KICAjIENvbnN0cnVjdCB0b3AgYW5ub3RhdGlvbiB0ZXh0DQogIGdldF90b3BfdGV4dCA8LSBmdW5jdGlvbigpIHsNCiAgICBiYXNlX3RleHQgPC0gcGFzdGUwKA0KICAgICAgaWZlbHNlKGNob2ljZV9ydWxlID09ICJkZXRlcm1pbmlzdGljIiwgImRldGVybWluaXN0aWMiLCAic3RvY2hhc3RpYyIpLCANCiAgICAgICIgdXBkYXRpbmcgfCAiLCBpbmZsdWVuY2UsICIgaW5mbHVlbmNlIg0KICAgICkNCiAgICBpZiAoaWRlbnRpY2FsKGZwbG90LCBmY3JlYXRlX2hlYXRtYXApKSB7DQogICAgICBpZiAoIWlzLm51bGwoa21pbikpIGJhc2VfdGV4dCA8LSBwYXN0ZTAoYmFzZV90ZXh0LCAiIHwgbWluLiBkZWdyZWU6ICIsIGttaW4pDQogICAgICBpZiAoIWlzLm51bGwoa21heCkpIGJhc2VfdGV4dCA8LSBwYXN0ZTAoYmFzZV90ZXh0LCAiIHwgbWF4LiBkZWdyZWU6ICIsIGttYXgpDQogICAgfQ0KICAgIHJldHVybihiYXNlX3RleHQpDQogIH0NCiAgDQogICMgRnVuY3Rpb24gdG8gY2FsbCBwbG90IHdpdGggY29ycmVjdCBhcmdzDQogIGNhbGxfcGxvdCA8LSBmdW5jdGlvbihtcCkgew0KICAgIGFyZ3MgPC0gbGlzdCgNCiAgICAgIGRhdGEgPSBkYXRhLA0KICAgICAgY2hvaWNlX3J1bGUgPSBjaG9pY2VfcnVsZSwNCiAgICAgIG1pbm9yaXR5X3Byb3AgPSBtcCwNCiAgICAgIGluZmx1ZW5jZSA9IGluZmx1ZW5jZQ0KICAgICkNCiAgICBpZiAoIWlzLm51bGwoa21pbikpIGFyZ3Mka21pbiA8LSBrbWluDQogICAgaWYgKGlkZW50aWNhbChmcGxvdCwgZmNyZWF0ZV9oZWF0bWFwKSAmJiAhaXMubnVsbChrbWF4KSkgYXJncyRrbWF4IDwtIGttYXgNCiAgICANCiAgICBkby5jYWxsKGZwbG90LCBhcmdzKSArIA0KICAgICAgZ2d0aXRsZShwYXN0ZTAoIlByb3BvcnRpb24gbWlub3JpdGllczogIiwgbXApKQ0KICB9DQogIA0KICAjIFNpbmdsZSBtaW5vcml0eSBwcm9wb3J0aW9uDQogIGlmIChsZW5ndGgobWlub3JpdHlfcHJvcHMpID09IDEpIHsNCiAgICBwIDwtIGNhbGxfcGxvdChtaW5vcml0eV9wcm9wcykNCiAgICByZXR1cm4oYW5ub3RhdGVfZmlndXJlKA0KICAgICAgcCwNCiAgICAgIHRvcCA9IHRleHRfZ3JvYihnZXRfdG9wX3RleHQoKSwgZmFjZSA9ICJib2xkIiwgc2l6ZSA9IDE0KQ0KICAgICkpDQogIH0NCiAgDQogICMgTXVsdGlwbGUgcHJvcG9ydGlvbnMNCiAgcGxvdHMgPC0gbGFwcGx5KG1pbm9yaXR5X3Byb3BzLCBjYWxsX3Bsb3QpDQogIGNvbWJpbmVkIDwtIGdnYXJyYW5nZShwbG90bGlzdCA9IHBsb3RzLCANCiAgICAgICAgICAgICAgICAgICAgICAgIG5jb2wgPSBsZW5ndGgobWlub3JpdHlfcHJvcHMpLCANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1vbi5sZWdlbmQgPSBUUlVFLCANCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZCA9ICJib3R0b20iKQ0KICANCiAgYW5ub3RhdGVfZmlndXJlKGNvbWJpbmVkLA0KICAgICAgICAgICAgICAgICAgdG9wID0gdGV4dF9ncm9iKGdldF90b3BfdGV4dCgpLCBmYWNlID0gImJvbGQiLCBzaXplID0gMTQpKQ0KfQ0KDQojIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGEgZ2lmIGRpc3BsYXlpbmcgdGhlIHByb3BhZ2F0aW9uIG9mIHRoZSBub3JtIHRocm91Z2ggYSAoc3RhdGljKSBuZXR3b3JrDQpmbmV0d29ya2dpZiA8LSBmdW5jdGlvbihuZXR3b3JrLCBkZWNpc2lvbl9oaXN0b3J5LCByb3VuZHMsIGZwcyA9IDIsIHdpZHRoID0gNiwgaGVpZ2h0ID0gNiwgb3V0cHV0X2RpciA9ICIuL2ZpZ3VyZXMiKSB7DQogIA0KICAjIGNvbG9ycyBmb3IgY2hvaWNlcw0KICBjaG9pY2VfY29sb3IgPC0gYygiMCIgPSBicmV3ZXIucGFsKDMsICJTZXQzIilbMV0sICANCiAgICAgICAgICAgICAgICAgICAgIjEiID0gYnJld2VyLnBhbCgzLCAiU2V0MyIpWzJdKSANCiAgDQogICMgZnVuY3Rpb24gdG8gZ2V0IHRoZSBjaG9pY2UgZGF0YSBmb3IgYSBzcGVjaWZpYyByb3VuZA0KICBmcm91bmRfZGF0YSA8LSBmdW5jdGlvbihyb3VuZF9udW1iZXIsIGRlY2lzaW9uX2hpc3RvcnkpIHsNCiAgICByb3VuZF9kYXRhIDwtIGRlY2lzaW9uX2hpc3RvcnkgJT4lDQogICAgICBmaWx0ZXIocm91bmQgPT0gcm91bmRfbnVtYmVyKSAlPiUNCiAgICAgIHNlbGVjdChpZCwgcm9sZSwgY2hvaWNlLCByb3VuZCkNCiAgICByZXR1cm4ocm91bmRfZGF0YSkNCiAgfQ0KICANCiAgIyBmdW5jdGlvbiB0byB1cGRhdGUgdGhlIG5ldHdvcmsgYW5kIHNldCBib3JkZXIgY29sb3IgYmFzZWQgb24gaW5pdGlhbCB0cmVuZHNldHRlcnMNCiAgZnVwZGF0ZV9jaG9pY2VzIDwtIGZ1bmN0aW9uKG5ldHdvcmssIGRlY2lzaW9uX2hpc3RvcnksIHJvdW5kX251bWJlcikgew0KICAgICMgZ2V0IHRoZSBkZWNpc2lvbnMgZm9yIHRoZSBzcGVjaWZpYyByb3VuZA0KICAgIHJvdW5kX2RhdGEgPC0gZnJvdW5kX2RhdGEocm91bmRfbnVtYmVyLCBkZWNpc2lvbl9oaXN0b3J5KQ0KICAgIA0KICAgICMgc2V0IHRoZSBub2RlIGF0dHJpYnV0ZSBiYXNlZCBvbiBhY3RvcnMnIGRlY2lzaW9ucw0KICAgIFYobmV0d29yaykkY2hvaWNlIDwtIGFzLmNoYXJhY3Rlcihyb3VuZF9kYXRhJGNob2ljZSkNCiAgICANCiAgICAjIGJvcmRlciBwcm9wZXJ0aWVzIHRvIGRpc3Rpbmd1aXNoIHRyZW5kc2V0dGVycw0KICAgIFYobmV0d29yaykkYm9yZGVyX2NvbG9yIDwtIGlmZWxzZShWKG5ldHdvcmspJHJvbGUgPT0gInRyZW5kc2V0dGVyIiwgImJsYWNrIiwgImdyZXk3MCIpDQogICAgVihuZXR3b3JrKSRib3JkZXJfc2l6ZSA8LSBpZmVsc2UoVihuZXR3b3JrKSRyb2xlID09ICJ0cmVuZHNldHRlciIsIDEsIDAuNSkNCiAgICByZXR1cm4obmV0d29yaykNCiAgfQ0KICANCiAgIyBmdW5jdGlvbiB0byBnZW5lcmF0ZSBhIGxpc3Qgb2YgdXBkYXRlZCBuZXR3b3Jrcw0KICBmdXBkYXRlX25ldHMgPC0gZnVuY3Rpb24obmV0d29yaywgZGVjaXNpb25faGlzdG9yeSwgcm91bmRzKSB7DQogICAgc25hcHNob3RzIDwtIGxpc3QoKQ0KICAgIA0KICAgIGZvciAocm91bmRfbnVtYmVyIGluIDE6cm91bmRzKSB7DQogICAgICB1cGRhdGVkX25ldHdvcmsgPC0gZnVwZGF0ZV9jaG9pY2VzKG5ldHdvcmssIGRlY2lzaW9uX2hpc3RvcnksIHJvdW5kX251bWJlcikgIA0KICAgICAgc25hcHNob3RzW1tyb3VuZF9udW1iZXJdXSA8LSB1cGRhdGVkX25ldHdvcmsNCiAgICB9DQogICAgcmV0dXJuKHNuYXBzaG90cykNCiAgfQ0KICANCiAgIyBnZW5lcmF0ZSB1cGRhdGVkIG5ldHdvcmtzIGZvciBhbGwgcm91bmRzDQogIGV2byA8LSBmdXBkYXRlX25ldHMobmV0d29yayA9IG5ldHdvcmssIGRlY2lzaW9uX2hpc3RvcnkgPSBkZWNpc2lvbl9oaXN0b3J5LCByb3VuZHMgPSByb3VuZHMpDQogIA0KICAjIGNyZWF0ZSBhIGxheW91dCBmb3IgZWFjaCBuZXR3b3JrDQogIHh5IDwtIGxheW91dF9uaWNlbHkoZXZvW1sxXV0pDQogIA0KICAjIGNyZWF0ZSBhIChzdGF0aWMpIHBsb3QgbGlzdA0KICBwTGlzdCA8LSB2ZWN0b3IoImxpc3QiLCBsZW5ndGgoZXZvKSkNCiAgDQogIGZvciAoaSBpbiAxOmxlbmd0aChldm8pKSB7DQogICAgIyBjYWxjdWxhdGUgdGhlIHBlcmNlbnRhZ2Ugb2YgYj0xDQogICAgY2hvaWNlMV9wZXJjZW50YWdlIDwtIHN1bShWKGV2b1tbaV1dKSRjaG9pY2UgPT0gIjEiKSAvIGxlbmd0aChWKGV2b1tbaV1dKSkgKiAxMDANCiAgICANCiAgICAjIHVwZGF0ZSB0aXRsZSB0byBpbmNsdWRlIHBlcmNlbnRhZ2UNCiAgICByb3VuZF90aXRsZSA8LSBwYXN0ZSgiUm91bmQiLCBpLCAiIC0gJSBhZ2VudHMgZm9sbG93aW5nIDxpPkI8L2k+IDoiLCByb3VuZChjaG9pY2UxX3BlcmNlbnRhZ2UsIDIpLCAiJSIpDQogICAgDQogICAgcExpc3RbW2ldXSA8LSBnZ3JhcGgoZXZvW1tpXV0sIGxheW91dCA9ICJtYW51YWwiLCB4ID0geHlbLCAxXSwgeSA9IHh5WywgMl0pICsNCiAgICAgIGdlb21fZWRnZV9saW5rMChlZGdlX3dpZHRoID0gMC4zLCBlZGdlX2NvbG91ciA9ICJncmV5NjYiKSArDQogICAgICBnZW9tX25vZGVfcG9pbnQoc2hhcGUgPSAyMSwgYWVzKGZpbGwgPSBhcy5mYWN0b3IoY2hvaWNlKSwgY29sb3IgPSBib3JkZXJfY29sb3IpLCBzaXplID0gNCwgc3Ryb2tlID0gVihldm9bW2ldXSkkYm9yZGVyX3NpemUpICsgIA0KICAgICAgc2NhbGVfZmlsbF9tYW51YWwodmFsdWVzID0gY2hvaWNlX2NvbG9yKSArDQogICAgICBzY2FsZV9jb2xvcl9pZGVudGl0eSgpICsNCiAgICAgIHRoZW1lX2dyYXBoKCkgKw0KICAgICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gIm5vbmUiKSArDQogICAgICBsYWJzKHRpdGxlID0gcm91bmRfdGl0bGUpICsNCiAgICAgIHRoZW1lKHBsb3QudGl0bGUgPSBlbGVtZW50X21hcmtkb3duKCkpDQogIH0NCiAgDQogICMgZW5zdXJlIHRoZSBvdXRwdXQgZGlyZWN0b3J5IGV4aXN0cw0KICBpZiAoIWRpci5leGlzdHMob3V0cHV0X2RpcikpIHsNCiAgICBkaXIuY3JlYXRlKG91dHB1dF9kaXIpDQogIH0NCiAgDQogICMgc2F2ZSBlYWNoIHBsb3QgdG8gaW5kaXZpZHVhbCBmaWxlcyBpbiB0aGUgc3BlY2lmaWVkIGRpcmVjdG9yeQ0KICBmb3IgKGkgaW4gMTpsZW5ndGgocExpc3QpKSB7DQogICAgZ2dzYXZlKHBhc3RlMChvdXRwdXRfZGlyLCAiL3Bsb3RfIiwgaSwgIi5wbmciKSwgcGxvdCA9IHBMaXN0W1tpXV0sIHdpZHRoID0gd2lkdGgsIGhlaWdodCA9IGhlaWdodCkNCiAgfQ0KICANCiAgIyByZWFkIHNhdmVkIGltYWdlcyBpbnRvIGEgbWFnaWNrIGltYWdlIG9iamVjdA0KICBpbWFnZV9maWxlcyA8LSBsaXN0LmZpbGVzKHBhdGggPSBvdXRwdXRfZGlyLCBwYXR0ZXJuID0gInBsb3RfLipcXC5wbmciLCBmdWxsLm5hbWVzID0gVFJVRSkNCiAgDQogICMgc29ydCB0aGUgaW1hZ2VzIGJ5IHRoZWlyIG51bWVyaWNhbCBvcmRlciAoMSB0byBYKQ0KICBpbWFnZV9maWxlcyA8LSBpbWFnZV9maWxlc1tvcmRlcihhcy5udW1lcmljKGdzdWIoIi4qXyhcXGQrKVxcLnBuZyIsICJcXDEiLCBpbWFnZV9maWxlcykpKV0NCiAgDQogIGltZ19saXN0IDwtIGltYWdlX3JlYWQoaW1hZ2VfZmlsZXMpDQogIA0KICAjIGNyZWF0ZSBhbiBhbmltYXRlZCBnaWYNCiAgZ2lmIDwtIGltYWdlX2FuaW1hdGUoaW1nX2xpc3QsIGZwcyA9IDIpDQogIA0KICAjIHNhdmUgdGhlIGdpZiB0byBhIGZpbGUNCiAgZ2lmX291dHB1dF9wYXRoIDwtIHBhc3RlMChvdXRwdXRfZGlyLCAiL2FuaW1hdGlvbi5naWYiKQ0KICBpbWFnZV93cml0ZShnaWYsIGdpZl9vdXRwdXRfcGF0aCkNCiAgDQogICMgcmVtb3ZlIHRoZSB0ZW1wb3JhcnkgcGxvdCBpbWFnZXMNCiAgZmlsZS5yZW1vdmUoaW1hZ2VfZmlsZXMpDQogIA0KICByZXR1cm4oZ2lmX291dHB1dF9wYXRoKQ0KfQ0KDQoNCg0KI3NvdXJjZTogaHR0cHM6Ly9ib29rZG93bi5vcmcvbWFya2hvZmYvc29jaWFsX25ldHdvcmtfYW5hbHlzaXMvdGhlLXNtYWxsLXdvcmxkLXByb2JsZW0tYW5kLXRoZS1hcnQtc2NpZW5jZS1vZi1zaW11bGF0aW9uLmh0bWwNCg0Kc2ltdWxhdGVfY2F2ZW1hbiA8LSBmdW5jdGlvbihuID0gMjUsIGNsaXF1ZV9zaXplID0gNSl7DQogIHJlcXVpcmUoaWdyYXBoKQ0KICAjIEdyb3VwcyBhcmUgYWxsIHRoZSBzYW1lIHNpemUsIHNvIEkgY2hlY2sgd2hldGhlciBOIGlzIGRpdmlzaWJsZSBieSB0aGUgc2l6ZSBvZiBncm91cHMNCiAgaWYgKCAoKG4lLyVjbGlxdWVfc2l6ZSkgKiBjbGlxdWVfc2l6ZSkgIT0gbil7DQogICAgc3RvcCgibiBpcyBub3QgZXZlbmx5IGRpdmlzaWJsZSBieSBjbGlxdWVfc2l6ZSIpDQogIH0NCiAgDQogIGdyb3VwcyA9IG4vY2xpcXVlX3NpemUgIyB0aGlzIGRldGVybWluZXMgdGhlIG51bWJlciBvZiBncm91cHMNCiAgDQogIGVsIDwtIGRhdGEuZnJhbWUoUGVyc29uQSA9IDE6biwgR3JvdXAgPSBOQSkgIyBJIGNyZWF0ZSBhIGRhdGFmcmFtZSB3aGljaCBoYXMgcGVvcGxlIGFuZCB0aGUgZ3JvdXBzIHRoZXkgYXJlIGluDQogICMgSSB0cmVhdCBpdCBsaWtlIGEgcGVyc29uIHRvIGdyb3VwIGVkZ2VsaXN0DQogIA0KICBncm91cF92ZWN0b3IgPSBjKCkNCiAgZm9yIChpIGluIDE6Z3JvdXBzKXsNCiAgICBncm91cF92ZWN0b3IgPC0gYyhncm91cF92ZWN0b3IsIHJlcChpLCBjbGlxdWVfc2l6ZSkpDQogIH0gIA0KICANCiAgZWwkR3JvdXAgPC0gZ3JvdXBfdmVjdG9yDQogIA0KICBpbmMgPC0gdGFibGUoZWwpICMgSSB1c2UgdGhlIHRhYmxlIGZ1bmN0aW9uIHRvIHR1cm4gdGhlIHBlcnNvbiB0byBncm91cCBlZGdlbGlzdCBpbnRvIGFuIGluY2lkZW5jZSBtYXRyaXgNCiAgYWRqIDwtIGluYyAlKiUgdChpbmMpICMgQW5kIEkgdXNlIG1hdHJpeCBtdWx0aXBsaWNhdGlvbiB3aXRoIHRoZSB0cmFuc3Bvc2UgdG8gdHVybiB0aGUgcGVyc29uIHRvIGdyb3VwIGluY2lkZW5jZSBtYXRyaXgNCiAgIyBpbnRvIGEgcGVyc29uIHRvIHBlcnNvbiBhZGphY2VuY3kgbWF0cml4DQogIA0KICBkaWFnKGFkaikgPC0gMCANCiAgDQogIGcgPC0gZ3JhcGguYWRqYWNlbmN5KGFkaiwgbW9kZSA9ICJ1bmRpcmVjdGVkIikgIyBJIGdyYXBoIHRoaXMgbWF0cml4DQogIA0KICBncm91cF9jb25uZWN0IDwtIHNlcShmcm9tID0gMSwgdG8gPSBuLCBieSA9IGNsaXF1ZV9zaXplKSAjIEkgZGV0ZXJtaW5lIHRoZSBwb2ludHMgb2YgY29ubmVjdGlvbiB1c2luZyBhIHNlcXVlbmNlIGZ1bmNpdG9uDQogIA0KICBmb3IoIGkgaW4gMToobGVuZ3RoKGdyb3VwX2Nvbm5lY3QpLTEpKXsNCiAgICBwMSA8LSBncm91cF9jb25uZWN0W2ldICsgMQ0KICAgIHAyIDwtIGdyb3VwX2Nvbm5lY3RbaSsxXQ0KICAgIGcgPC0gYWRkLmVkZ2VzKGcsIGMocDEscDIpKSAjIEFuZCBJIGNvbm5lY3QgdGhlIHBvaW50cyBvZiBjb25uZWN0aW9uIHVzaW5nIGFkZC5lZGdlcw0KICB9DQogIGcgPC0gYWRkLmVkZ2VzKGcsIGMoZ3JvdXBfY29ubmVjdFsxXSwoZ3JvdXBfY29ubmVjdFtncm91cHNdKzEpKSkgIyBmaW5hbGx5IEkgY29ubmVjdCB0aGUgZW5kcyBvZiB0aGUgc3RydWN0dXJlIHNvIHRoYXQgaXQgZm9ybXMgYSBjaXJjbGUNCiAgDQogIHJldHVybihnKSAgICANCn0NCg==" download="custom_functions.R">Download custom_functions.R</a>.</p>
<pre class="r test"><code>source(&quot;./custom_functions.R&quot;)</code></pre>
<p><br></p>
</div>
<div id="necessary-packages" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> necessary
packages</h2>
<ul>
<li><code>tidyverse</code>: data wrangling</li>
<li><code>igraph</code>: generate and visualize graphs</li>
<li><code>parallel</code>: parallel computing to speed up
simulation</li>
<li><code>foreach</code>: looping in parallel</li>
<li><code>doParallel</code>: parallel backend for
<code>foreach</code></li>
<li><code>ggplot2</code>: data visualization</li>
<li><code>ggh4x</code>: hacks for <code>ggplot2</code></li>
<li><code>ggpubr</code>: make visualizations publication-ready</li>
</ul>
<pre class="r test"><code>packages = c(&quot;tidyverse&quot;, &quot;igraph&quot;, &quot;ggplot2&quot;, &quot;parallel&quot;, &quot;doParallel&quot;, &quot;foreach&quot;, &quot;ggh4x&quot;, &quot;ggpubr&quot;,
    &quot;plotly&quot;, &quot;RColorBrewer&quot;, &quot;grid&quot;, &quot;gridExtra&quot;, &quot;patchwork&quot;, &quot;ggplotify&quot;, &quot;ggraph&quot;, &quot;gganimate&quot;, &quot;RColorBrewer&quot;,
    &quot;ggtext&quot;, &quot;magick&quot;, &quot;jsonlite&quot;)

invisible(fpackage.check(packages))
rm(packages)</code></pre>
<hr />
</div>
</div>
<div id="experimental-conditions" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Experimental
conditions</h1>
<div id="scale-free-network-with-central-minorities"
class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> 1. scale-free network
with central minorities</h2>
<p>Lets take a likely-case for an unpopular norm, generate multiple
networks of this target, and simulate the emergence of the norm
following a deterministic and probabilistic choice model:</p>
<pre class="r test"><code># pick one configuration that likely leads to an unpopular norm, and explore multiple &#39;seeds&#39;:
run_one_seed &lt;- function(
  i,
  base_seed = 1253281,
  params = list(s = 15, e = 10, w = 40, z = 50, lambda1 = 5, lambda2 = 1.8),
  
  # tweak network
  k_min = 2, 
  k_max = 20,
  alpha = 2.4,
  rho = 0.4,
  r = -0.1,
  
  # retrieve network
  return_network = FALSE
  
) {
  # derived seed for this run
  seed_i &lt;- base_seed + i
  set.seed(seed_i)

  # --- network creation ---
  degseq &lt;- fdegseq(
    n      = 100, 
    alpha  = alpha,
    k_min  = k_min,
    k_max  = k_max,
    dist   = &quot;power-law&quot;,
    seed   = seed_i
  )

  network &lt;- sample_degseq(degseq, method = &quot;vl&quot;)
  
  V(network)$role &lt;- sample(
    c(rep(&quot;trendsetter&quot;, 10), rep(&quot;conformist&quot;, 90))
  )
  
  rewired_network &lt;- frewire_r(network, r, verbose = FALSE, max_iter = 1e5)
  final_network   &lt;- fswap_rho(rewired_network, rho, verbose = FALSE, max_iter = 1e4)
  
  # --- stats ---
  stats &lt;- list(
    run           = i,
    seed          = seed_i,
    num_nodes     = vcount(final_network),
    num_edges     = ecount(final_network),
    avg_degree    = mean(degree(final_network)),
    sd_degree     = sd(degree(final_network)),
    net_density   = edge_density(final_network),
    net_diameter  = diameter(final_network, directed = FALSE, unconnected = TRUE),
    avg_path_len  = average.path.length(final_network, directed = FALSE),
    clust_coeff   = transitivity(final_network, type = &quot;global&quot;),
    assort_deg    = assortativity_degree(final_network),
    deg_trait_cor = fdegtraitcor(final_network)$cor,
    components    = components(final_network)$no
  )
  
  fplot_graph(final_network) 
  
  # --- initial actions ---
  V(final_network)$action &lt;- ifelse(V(final_network)$role == &quot;trendsetter&quot;, 1, 0)
  
  # --- deterministic simulation ---
  sim_det &lt;- fabm(
    network      = final_network,
    params       = params,
    max_rounds   = 50,
    mi_threshold = 0.49,
    choice_rule  = &quot;deterministic&quot;,
    plot         = TRUE,
    histories    = TRUE
  )
  
  # generate the gif for the current network
  gif_filename &lt;- paste0(&quot;./figures/animation_network_&quot;, seed_i, &quot;.gif&quot;)
  gif_path &lt;- fnetworkgif(final_network, sim_det$decision_history, rounds = sim_det$equilibrium$round, output_dir = &quot;./figures&quot;)
  # rename the gif to match the naming pattern
  file.rename(gif_path, gif_filename)

  if (!is.null(sim_det$plot)) {
    print(sim_det$plot)
  }
  
  # --- probabilistic simulation ---
  sim_prob &lt;- fabm(
    network                = final_network,
    params                 = params,
    max_rounds             = 100,
    mi_threshold           = 0.49,
    choice_rule            = &quot;probabilistic&quot;,
    stable_window          = 8,   # the length of the window of adoption values
    required_stable_rounds = 20, # number of windows needed to declare equilibrium
    plot                   = TRUE
  )
  if (!is.null(sim_prob$plot)) {
    print(sim_prob$plot)
  }
  
   result &lt;- list(
    segregation_det  = sim_det$equilibrium$segregation,
    segregation_prob = sim_prob$equilibrium$segregation,
    stats            = stats
  )
  
  if (return_network) {
    result$network &lt;- final_network
  }
  
  result
}</code></pre>
<pre class="r test"><code>test &lt;- run_one_seed(1, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1, return_network = TRUE)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-2-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-2-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<pre class="r test"><code>base = 1253281
seed = base + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253282.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(2, k_min = 2, k_max = 30, alpha = 2.4, rho = 0.4, r = -0.1, return_network = TRUE)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-4-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-4-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1

test$stats</code></pre>
<pre class="test3"><code>#&gt; $run
#&gt; [1] 2
#&gt; 
#&gt; $seed
#&gt; [1] 1253283
#&gt; 
#&gt; $num_nodes
#&gt; [1] 100
#&gt; 
#&gt; $num_edges
#&gt; [1] 214
#&gt; 
#&gt; $avg_degree
#&gt; [1] 4.28
#&gt; 
#&gt; $sd_degree
#&gt; [1] 4.276031
#&gt; 
#&gt; $net_density
#&gt; [1] 0.04323232
#&gt; 
#&gt; $net_diameter
#&gt; [1] 7
#&gt; 
#&gt; $avg_path_len
#&gt; [1] 3.129293
#&gt; 
#&gt; $clust_coeff
#&gt; [1] 0.1026758
#&gt; 
#&gt; $assort_deg
#&gt; [1] -0.1017772
#&gt; 
#&gt; $deg_trait_cor
#&gt; [1] 0.4324733
#&gt; 
#&gt; $components
#&gt; [1] 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253283.gif" width="60%" /></p>
<pre class="r test"><code># use this as the network structure for an otree session:
cbind(degree(test$network), V(test$network)$role)

# convert to adjacency matrix
adj_matrix &lt;- as.matrix(as_adjacency_matrix(test$network))

# get roles
role_vector &lt;- ifelse(V(test$network)$role == &quot;trendsetter&quot;, 1, 0)
# create a list to store the network data
net &lt;- list(adj_matrix = adj_matrix, role_vector = role_vector)
# save the list as a JSON file
write_json(net, &quot;network_test_n100.json&quot;)</code></pre>
<pre class="r test"><code>test &lt;- run_one_seed(3, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253284.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(4, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-9-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-9-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253285.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(5, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-11-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-11-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-11-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253286.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(6, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-13-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-13-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253287.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(7, k_min = 2, k_max = 20, alpha = 2.4, rho = 0.4, r = -0.1)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-15-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-15-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253288.gif" width="60%" /></p>
<p>Increase the density:</p>
<pre class="r test"><code>test &lt;- run_one_seed(8, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-17-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-17-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253289.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(9, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-19-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-19-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-19-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253290.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(10, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-21-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-21-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-21-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253291.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(11, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-23-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-23-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253292.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(12, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-25-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-25-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-25-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253293.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(13, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-27-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-27-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-27-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253294.gif" width="60%" /></p>
<pre class="r test"><code>test &lt;- run_one_seed(14, k_min = 4, k_max = 99, alpha = 2.1, rho = 0.5, r = -0.4)</code></pre>
<p><img src="experiment_files/figure-html/unnamed-chunk-29-1.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-29-2.png" width="672" /><img src="experiment_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>
<pre class="r test"><code>seed = seed + 1</code></pre>
<pre class="r test"><code>knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
<p><img src="figures/animation_network_1253295.gif" width="60%" /></p>
</div>
<div id="small-worlds" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> 2. small-worlds</h2>
<pre class="r test"><code>run_one_sw &lt;- function(
  i,
  base_seed = 1253281,
  model = &quot;watts-strogatz&quot;,
  beta = 0,
  nei = 3,
  clique_size = 5,
  pmin = 0.1,
  
  params = list(s = 15, e = 10, w = 40, z = 50, lambda1 = 5, lambda2 = 1.8)
) {
  # derived seed for this run
  seed_i &lt;- base_seed + i
  set.seed(seed_i)

  if (model == &quot;watts-strogatz&quot;) {
    network &lt;- sample_smallworld(dim = 1, size = 100, nei = 3, p = beta) }
  else if (model == &quot;caveman&quot;) {
    network &lt;- simulate_caveman(n = 100, clique_size = clique_size) 
  }

  V(network)$role &lt;- sample(
    c(rep(&quot;trendsetter&quot;, round(100*pmin)), rep(&quot;conformist&quot;, 100-round(100*pmin)))
  )
  
  
  final_network &lt;- network

  
  # --- stats ---
  stats &lt;- list(
    run           = i,
    seed          = seed_i,
    num_nodes     = vcount(final_network),
    num_edges     = ecount(final_network),
    avg_degree    = mean(degree(final_network)),
    sd_degree     = sd(degree(final_network)),
    net_density   = edge_density(final_network),
    net_diameter  = diameter(final_network, directed = FALSE, unconnected = TRUE),
    avg_path_len  = average.path.length(final_network, directed = FALSE),
    clust_coeff   = transitivity(final_network, type = &quot;global&quot;),
    assort_deg    = assortativity_degree(final_network),
    deg_trait_cor = fdegtraitcor(final_network)$cor,
    components    = components(final_network)$no
  )
  
  stats_df &lt;- data.frame(
    Metric = names(stats),
    Value  = unlist(stats),
    row.names = NULL
  )
  
  #print(stats_df)
  fplot_graph(final_network, layout = layout.kamada.kawai(final_network))
  

  # --- initial actions ---
  V(final_network)$action &lt;- ifelse(V(final_network)$role == &quot;trendsetter&quot;, 1, 0)
  
  # --- deterministic simulation ---
  sim_det &lt;- fabm(
    network      = final_network,
    params       = params,
    max_rounds   = 50,
    mi_threshold = 0.49,
    choice_rule  = &quot;deterministic&quot;,
    plot         = TRUE,
    histories    = TRUE
  )

  # generate the gif for the current network
  gif_filename &lt;- paste0(&quot;./figures/animation_network_&quot;, seed_i, &quot;.gif&quot;)
  gif_path &lt;- fnetworkgif(final_network, sim_det$decision_history, rounds = sim_det$equilibrium$round, output_dir = &quot;./figures&quot;)
  # rename the gif to match the naming pattern
  file.rename(gif_path, gif_filename)
  
  
  if (!is.null(sim_det$plot)) {
    print(sim_det$plot)
  }
  
  # --- probabilistic simulation ---
  sim_prob &lt;- fabm(
    network                = final_network,
    params                 = params,
    max_rounds             = 100,
    mi_threshold           = 0.49,
    choice_rule            = &quot;probabilistic&quot;,
    stable_window          = 8,   # the length of the window of adoption values
    required_stable_rounds = 20, # number of windows needed to declare equilibrium
    plot                   = TRUE
  )
  if (!is.null(sim_prob$plot)) {
    print(sim_prob$plot)
  }
  
  list(
    #run   = i,
    #seed  = seed_i,
    segregation_det = sim_det$equilibrium$segregation,
    segregation_prob = sim_prob$equilibrium$segregation,
    stats = stats
  )
}</code></pre>
<pre class="r test"><code>test &lt;- run_one_sw(i = 15, model = &quot;caveman&quot;, clique_size = 5, pmin = 0.15)
seed = seed + 1

knitr::include_graphics(paste0(&quot;./figures/animation_network_&quot;, seed, &quot;.gif&quot;))</code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tDQp0aXRsZTogIkV4cGVyaW1lbnQiDQpiaWJsaW9ncmFwaHk6IHJlZmVyZW5jZXMuYmliDQpsaW5rLWNpdGF0aW9uczogdHJ1ZQ0KZGF0ZTogIkxhc3QgY29tcGlsZWQgb24gYHIgZm9ybWF0KFN5cy50aW1lKCksICclZC0lbS0lWScpYCINCm91dHB1dDogDQogIGh0bWxfZG9jdW1lbnQ6DQogICAgc2VsZl9jb250YWluZWQ6IHRydWUNCiAgICBjc3M6IHR3ZWFrcy5jc3MNCiAgICB0b2M6IHRydWUNCiAgICB0b2NfZmxvYXQ6IHRydWUNCiAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUNCiAgICB0b2NfZGVwdGg6IDQNCiAgICBjb2RlX2ZvbGRpbmc6IHNob3cNCiAgICBjb2RlX2Rvd25sb2FkOiB5ZXMNCi0tLQ0KDQpgYGB7ciwgZ2xvYmFsc2V0dGluZ3MsIGVjaG89RkFMU0UsIHdhcm5pbmc9RkFMU0UsIHJlc3VsdHM9J2hpZGUnLCBtZXNzYWdlPUZBTFNFfQ0KbGlicmFyeShrbml0cikNCmxpYnJhcnkodGlkeXZlcnNlKQ0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KGVjaG8gPSBUUlVFKQ0Kb3B0c19jaHVuayRzZXQodGlkeS5vcHRzPWxpc3Qod2lkdGguY3V0b2ZmPTEwMCksdGlkeT1UUlVFLCB3YXJuaW5nID0gRkFMU0UsIG1lc3NhZ2UgPSBGQUxTRSxjb21tZW50ID0gIiM+IiwgY2FjaGU9VFJVRSwgY2xhc3Muc291cmNlPWMoInRlc3QiKSwgY2xhc3Mub3V0cHV0PWMoInRlc3QzIikpDQpvcHRpb25zKHdpZHRoID0gMTAwKQ0KcmdsOjpzZXR1cEtuaXRyKCkNCg0KY29sb3JpemUgPC0gZnVuY3Rpb24oeCwgY29sb3IpIHtzcHJpbnRmKCI8c3BhbiBzdHlsZT0nY29sb3I6ICVzOyc+JXM8L3NwYW4+IiwgY29sb3IsIHgpIH0NCmBgYA0KDQpgYGB7ciBrbGlwcHksIGVjaG89RkFMU0UsIGluY2x1ZGU9VFJVRX0NCmtsaXBweTo6a2xpcHB5KHBvc2l0aW9uID0gYygndG9wJywgJ3JpZ2h0JykpDQoja2xpcHB5OjprbGlwcHkoY29sb3IgPSAnZGFya3JlZCcpDQoja2xpcHB5OjprbGlwcHkodG9vbHRpcF9tZXNzYWdlID0gJ0NsaWNrIHRvIGNvcHknLCB0b29sdGlwX3N1Y2Nlc3MgPSAnRG9uZScpDQpgYGANCg0KLS0tDQoNCiMgR2V0dGluZyBzdGFydGVkDQoNClRvIGNvcHkgdGhlIGNvZGUsIGNsaWNrIHRoZSBidXR0b24gaW4gdGhlIHVwcGVyIHJpZ2h0IGNvcm5lciBvZiB0aGUgY29kZS1jaHVua3MuDQoNCiMjIGNsZWFuIHVwDQoNCmBgYHtyLCBjbGVhbl91cCwgcmVzdWx0cz0naGlkZSd9DQpybShsaXN0PWxzKCkpDQpnYygpDQpgYGANCg0KPGJyPg0KDQojIyBjdXN0b20gZnVuY3Rpb25zDQoNCldlIGRlZmluZWQgYSBudW1iZXIgY3VzdG9tIGZ1bmN0aW9ucywgYXQgYHIgeGZ1bjo6ZW1iZWRfZmlsZSgiLi9jdXN0b21fZnVuY3Rpb25zLlIiKWAuDQoNCmBgYHtyLCBjdXN0b21fZnVuY3Rpb25zfQ0Kc291cmNlKCIuL2N1c3RvbV9mdW5jdGlvbnMuUiIpDQpgYGANCg0KPGJyPg0KDQojIyBuZWNlc3NhcnkgcGFja2FnZXMNCg0KLSBgdGlkeXZlcnNlYDogZGF0YSB3cmFuZ2xpbmcNCi0gYGlncmFwaGA6IGdlbmVyYXRlIGFuZCB2aXN1YWxpemUgZ3JhcGhzDQotIGBwYXJhbGxlbGA6IHBhcmFsbGVsIGNvbXB1dGluZyB0byBzcGVlZCB1cCBzaW11bGF0aW9uDQotIGBmb3JlYWNoYDogbG9vcGluZyBpbiBwYXJhbGxlbA0KLSBgZG9QYXJhbGxlbGA6IHBhcmFsbGVsIGJhY2tlbmQgZm9yIGBmb3JlYWNoYA0KLSBgZ2dwbG90MmA6IGRhdGEgdmlzdWFsaXphdGlvbg0KLSBgZ2doNHhgOiBoYWNrcyBmb3IgYGdncGxvdDJgDQotIGBnZ3B1YnJgOiBtYWtlIHZpc3VhbGl6YXRpb25zIHB1YmxpY2F0aW9uLXJlYWR5DQoNCmBgYHtyLCBwYWNrYWdlc30NCnBhY2thZ2VzID0gYygidGlkeXZlcnNlIiwgImlncmFwaCIsICJnZ3Bsb3QyIiwgInBhcmFsbGVsIiwgImRvUGFyYWxsZWwiLCAiZm9yZWFjaCIsICJnZ2g0eCIsICJnZ3B1YnIiLCAicGxvdGx5IiwgIlJDb2xvckJyZXdlciIsICJncmlkIiwgImdyaWRFeHRyYSIsICJwYXRjaHdvcmsiLCAiZ2dwbG90aWZ5IiwgImdncmFwaCIsICJnZ2FuaW1hdGUiLCAiUkNvbG9yQnJld2VyIiwNCiAgICAiZ2d0ZXh0IiwgIm1hZ2ljayIsICJqc29ubGl0ZSIpDQoNCmludmlzaWJsZShmcGFja2FnZS5jaGVjayhwYWNrYWdlcykpDQpybShwYWNrYWdlcykNCmBgYA0KDQotLS0NCg0KIyBFeHBlcmltZW50YWwgY29uZGl0aW9ucw0KDQojIyAxLiBzY2FsZS1mcmVlIG5ldHdvcmsgd2l0aCBjZW50cmFsIG1pbm9yaXRpZXMNCg0KTGV0J3MgdGFrZSBhIGxpa2VseS1jYXNlIGZvciBhbiB1bnBvcHVsYXIgbm9ybSwgZ2VuZXJhdGUgbXVsdGlwbGUgbmV0d29ya3Mgb2YgdGhpcyB0YXJnZXQsIGFuZCBzaW11bGF0ZSB0aGUgZW1lcmdlbmNlIG9mIHRoZSBub3JtIGZvbGxvd2luZyBhIGRldGVybWluaXN0aWMgYW5kIHByb2JhYmlsaXN0aWMgY2hvaWNlIG1vZGVsOg0KDQpgYGB7ciwgZWNobz1UUlVFLCBmaWcuc2hvdz0naG9sZCcsIGZpZy5rZWVwPSdhbGwnLCBtZXNzYWdlPUZBTFNFLCBmaWcuaGVpZ2h0PTV9DQojIHBpY2sgb25lIGNvbmZpZ3VyYXRpb24gdGhhdCBsaWtlbHkgbGVhZHMgdG8gYW4gdW5wb3B1bGFyIG5vcm0sIGFuZCBleHBsb3JlIG11bHRpcGxlICdzZWVkcyc6DQpydW5fb25lX3NlZWQgPC0gZnVuY3Rpb24oDQogIGksDQogIGJhc2Vfc2VlZCA9IDEyNTMyODEsDQogIHBhcmFtcyA9IGxpc3QocyA9IDE1LCBlID0gMTAsIHcgPSA0MCwgeiA9IDUwLCBsYW1iZGExID0gNSwgbGFtYmRhMiA9IDEuOCksDQogIA0KICAjIHR3ZWFrIG5ldHdvcmsNCiAga19taW4gPSAyLCANCiAga19tYXggPSAyMCwNCiAgYWxwaGEgPSAyLjQsDQogIHJobyA9IDAuNCwNCiAgciA9IC0wLjEsDQogIA0KICAjIHJldHJpZXZlIG5ldHdvcmsNCiAgcmV0dXJuX25ldHdvcmsgPSBGQUxTRQ0KICANCikgew0KICAjIGRlcml2ZWQgc2VlZCBmb3IgdGhpcyBydW4NCiAgc2VlZF9pIDwtIGJhc2Vfc2VlZCArIGkNCiAgc2V0LnNlZWQoc2VlZF9pKQ0KDQogICMgLS0tIG5ldHdvcmsgY3JlYXRpb24gLS0tDQogIGRlZ3NlcSA8LSBmZGVnc2VxKA0KICAgIG4gICAgICA9IDEwMCwgDQogICAgYWxwaGEgID0gYWxwaGEsDQogICAga19taW4gID0ga19taW4sDQogICAga19tYXggID0ga19tYXgsDQogICAgZGlzdCAgID0gInBvd2VyLWxhdyIsDQogICAgc2VlZCAgID0gc2VlZF9pDQogICkNCg0KICBuZXR3b3JrIDwtIHNhbXBsZV9kZWdzZXEoZGVnc2VxLCBtZXRob2QgPSAidmwiKQ0KICANCiAgVihuZXR3b3JrKSRyb2xlIDwtIHNhbXBsZSgNCiAgICBjKHJlcCgidHJlbmRzZXR0ZXIiLCAxMCksIHJlcCgiY29uZm9ybWlzdCIsIDkwKSkNCiAgKQ0KICANCiAgcmV3aXJlZF9uZXR3b3JrIDwtIGZyZXdpcmVfcihuZXR3b3JrLCByLCB2ZXJib3NlID0gRkFMU0UsIG1heF9pdGVyID0gMWU1KQ0KICBmaW5hbF9uZXR3b3JrICAgPC0gZnN3YXBfcmhvKHJld2lyZWRfbmV0d29yaywgcmhvLCB2ZXJib3NlID0gRkFMU0UsIG1heF9pdGVyID0gMWU0KQ0KICANCiAgIyAtLS0gc3RhdHMgLS0tDQogIHN0YXRzIDwtIGxpc3QoDQogICAgcnVuICAgICAgICAgICA9IGksDQogICAgc2VlZCAgICAgICAgICA9IHNlZWRfaSwNCiAgICBudW1fbm9kZXMgICAgID0gdmNvdW50KGZpbmFsX25ldHdvcmspLA0KICAgIG51bV9lZGdlcyAgICAgPSBlY291bnQoZmluYWxfbmV0d29yayksDQogICAgYXZnX2RlZ3JlZSAgICA9IG1lYW4oZGVncmVlKGZpbmFsX25ldHdvcmspKSwNCiAgICBzZF9kZWdyZWUgICAgID0gc2QoZGVncmVlKGZpbmFsX25ldHdvcmspKSwNCiAgICBuZXRfZGVuc2l0eSAgID0gZWRnZV9kZW5zaXR5KGZpbmFsX25ldHdvcmspLA0KICAgIG5ldF9kaWFtZXRlciAgPSBkaWFtZXRlcihmaW5hbF9uZXR3b3JrLCBkaXJlY3RlZCA9IEZBTFNFLCB1bmNvbm5lY3RlZCA9IFRSVUUpLA0KICAgIGF2Z19wYXRoX2xlbiAgPSBhdmVyYWdlLnBhdGgubGVuZ3RoKGZpbmFsX25ldHdvcmssIGRpcmVjdGVkID0gRkFMU0UpLA0KICAgIGNsdXN0X2NvZWZmICAgPSB0cmFuc2l0aXZpdHkoZmluYWxfbmV0d29yaywgdHlwZSA9ICJnbG9iYWwiKSwNCiAgICBhc3NvcnRfZGVnICAgID0gYXNzb3J0YXRpdml0eV9kZWdyZWUoZmluYWxfbmV0d29yayksDQogICAgZGVnX3RyYWl0X2NvciA9IGZkZWd0cmFpdGNvcihmaW5hbF9uZXR3b3JrKSRjb3IsDQogICAgY29tcG9uZW50cyAgICA9IGNvbXBvbmVudHMoZmluYWxfbmV0d29yaykkbm8NCiAgKQ0KICANCiAgZnBsb3RfZ3JhcGgoZmluYWxfbmV0d29yaykgDQogIA0KICAjIC0tLSBpbml0aWFsIGFjdGlvbnMgLS0tDQogIFYoZmluYWxfbmV0d29yaykkYWN0aW9uIDwtIGlmZWxzZShWKGZpbmFsX25ldHdvcmspJHJvbGUgPT0gInRyZW5kc2V0dGVyIiwgMSwgMCkNCiAgDQogICMgLS0tIGRldGVybWluaXN0aWMgc2ltdWxhdGlvbiAtLS0NCiAgc2ltX2RldCA8LSBmYWJtKA0KICAgIG5ldHdvcmsgICAgICA9IGZpbmFsX25ldHdvcmssDQogICAgcGFyYW1zICAgICAgID0gcGFyYW1zLA0KICAgIG1heF9yb3VuZHMgICA9IDUwLA0KICAgIG1pX3RocmVzaG9sZCA9IDAuNDksDQogICAgY2hvaWNlX3J1bGUgID0gImRldGVybWluaXN0aWMiLA0KICAgIHBsb3QgICAgICAgICA9IFRSVUUsDQogICAgaGlzdG9yaWVzICAgID0gVFJVRQ0KICApDQogIA0KICAjIGdlbmVyYXRlIHRoZSBnaWYgZm9yIHRoZSBjdXJyZW50IG5ldHdvcmsNCiAgZ2lmX2ZpbGVuYW1lIDwtIHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWRfaSwgIi5naWYiKQ0KICBnaWZfcGF0aCA8LSBmbmV0d29ya2dpZihmaW5hbF9uZXR3b3JrLCBzaW1fZGV0JGRlY2lzaW9uX2hpc3RvcnksIHJvdW5kcyA9IHNpbV9kZXQkZXF1aWxpYnJpdW0kcm91bmQsIG91dHB1dF9kaXIgPSAiLi9maWd1cmVzIikNCiAgIyByZW5hbWUgdGhlIGdpZiB0byBtYXRjaCB0aGUgbmFtaW5nIHBhdHRlcm4NCiAgZmlsZS5yZW5hbWUoZ2lmX3BhdGgsIGdpZl9maWxlbmFtZSkNCg0KICBpZiAoIWlzLm51bGwoc2ltX2RldCRwbG90KSkgew0KICAgIHByaW50KHNpbV9kZXQkcGxvdCkNCiAgfQ0KICANCiAgIyAtLS0gcHJvYmFiaWxpc3RpYyBzaW11bGF0aW9uIC0tLQ0KICBzaW1fcHJvYiA8LSBmYWJtKA0KICAgIG5ldHdvcmsgICAgICAgICAgICAgICAgPSBmaW5hbF9uZXR3b3JrLA0KICAgIHBhcmFtcyAgICAgICAgICAgICAgICAgPSBwYXJhbXMsDQogICAgbWF4X3JvdW5kcyAgICAgICAgICAgICA9IDEwMCwNCiAgICBtaV90aHJlc2hvbGQgICAgICAgICAgID0gMC40OSwNCiAgICBjaG9pY2VfcnVsZSAgICAgICAgICAgID0gInByb2JhYmlsaXN0aWMiLA0KICAgIHN0YWJsZV93aW5kb3cgICAgICAgICAgPSA4LCAgICMgdGhlIGxlbmd0aCBvZiB0aGUgd2luZG93IG9mIGFkb3B0aW9uIHZhbHVlcw0KICAgIHJlcXVpcmVkX3N0YWJsZV9yb3VuZHMgPSAyMCwgIyBudW1iZXIgb2Ygd2luZG93cyBuZWVkZWQgdG8gZGVjbGFyZSBlcXVpbGlicml1bQ0KICAgIHBsb3QgICAgICAgICAgICAgICAgICAgPSBUUlVFDQogICkNCiAgaWYgKCFpcy5udWxsKHNpbV9wcm9iJHBsb3QpKSB7DQogICAgcHJpbnQoc2ltX3Byb2IkcGxvdCkNCiAgfQ0KICANCiAgIHJlc3VsdCA8LSBsaXN0KA0KICAgIHNlZ3JlZ2F0aW9uX2RldCAgPSBzaW1fZGV0JGVxdWlsaWJyaXVtJHNlZ3JlZ2F0aW9uLA0KICAgIHNlZ3JlZ2F0aW9uX3Byb2IgPSBzaW1fcHJvYiRlcXVpbGlicml1bSRzZWdyZWdhdGlvbiwNCiAgICBzdGF0cyAgICAgICAgICAgID0gc3RhdHMNCiAgKQ0KICANCiAgaWYgKHJldHVybl9uZXR3b3JrKSB7DQogICAgcmVzdWx0JG5ldHdvcmsgPC0gZmluYWxfbmV0d29yaw0KICB9DQogIA0KICByZXN1bHQNCn0NCg0KYGBgDQoNCg0KYGBge3J9DQp0ZXN0IDwtIHJ1bl9vbmVfc2VlZCgxLCBrX21pbiA9IDIsIGtfbWF4ID0gMjAsIGFscGhhID0gMi40LCByaG8gPSAwLjQsIHIgPSAtMC4xLCByZXR1cm5fbmV0d29yayA9IFRSVUUpDQoNCmJhc2UgPSAxMjUzMjgxDQpzZWVkID0gYmFzZSArIDENCmBgYCANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KYGBge3J9DQp0ZXN0IDwtIHJ1bl9vbmVfc2VlZCgyLCBrX21pbiA9IDIsIGtfbWF4ID0gMzAsIGFscGhhID0gMi40LCByaG8gPSAwLjQsIHIgPSAtMC4xLCByZXR1cm5fbmV0d29yayA9IFRSVUUpDQpzZWVkID0gc2VlZCArIDENCg0KdGVzdCRzdGF0cw0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyLCBldmFsID0gRkFMU0V9DQojIHVzZSB0aGlzIGFzIHRoZSBuZXR3b3JrIHN0cnVjdHVyZSBmb3IgYW4gb3RyZWUgc2Vzc2lvbjoNCmNiaW5kKGRlZ3JlZSh0ZXN0JG5ldHdvcmspLFYodGVzdCRuZXR3b3JrKSRyb2xlKQ0KDQojIGNvbnZlcnQgdG8gYWRqYWNlbmN5IG1hdHJpeA0KYWRqX21hdHJpeCA8LSBhcy5tYXRyaXgoYXNfYWRqYWNlbmN5X21hdHJpeCh0ZXN0JG5ldHdvcmspKQ0KDQojZ2V0IHJvbGVzDQpyb2xlX3ZlY3RvciA8LSBpZmVsc2UoVih0ZXN0JG5ldHdvcmspJHJvbGUgPT0gInRyZW5kc2V0dGVyIiwxLDApDQojIGNyZWF0ZSBhIGxpc3QgdG8gc3RvcmUgdGhlIG5ldHdvcmsgZGF0YQ0KbmV0IDwtIGxpc3QoYWRqX21hdHJpeCA9IGFkal9tYXRyaXgsIHJvbGVfdmVjdG9yID0gcm9sZV92ZWN0b3IpDQojIHNhdmUgdGhlIGxpc3QgYXMgYSBKU09OIGZpbGUNCndyaXRlX2pzb24obmV0LCAibmV0d29ya190ZXN0X24xMDAuanNvbiIpDQoNCmBgYA0KDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoMywga19taW4gPSAyLCBrX21heCA9IDIwLCBhbHBoYSA9IDIuNCwgcmhvID0gMC40LCByID0gLTAuMSkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoNCwga19taW4gPSAyLCBrX21heCA9IDIwLCBhbHBoYSA9IDIuNCwgcmhvID0gMC40LCByID0gLTAuMSkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoNSwga19taW4gPSAyLCBrX21heCA9IDIwLCBhbHBoYSA9IDIuNCwgcmhvID0gMC40LCByID0gLTAuMSkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoNiwga19taW4gPSAyLCBrX21heCA9IDIwLCBhbHBoYSA9IDIuNCwgcmhvID0gMC40LCByID0gLTAuMSkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoNywga19taW4gPSAyLCBrX21heCA9IDIwLCBhbHBoYSA9IDIuNCwgcmhvID0gMC40LCByID0gLTAuMSkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCkluY3JlYXNlIHRoZSBkZW5zaXR5Og0KDQpgYGB7cn0NCnRlc3QgPC0gcnVuX29uZV9zZWVkKDgsIGtfbWluID0gNCwga19tYXggPSA5OSwgYWxwaGEgPSAyLjEsIHJobyA9IDAuNSwgciA9IC0wLjQpDQpzZWVkID0gc2VlZCArIDENCmBgYCANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KYGBge3J9DQp0ZXN0IDwtIHJ1bl9vbmVfc2VlZCg5LCBrX21pbiA9IDQsIGtfbWF4ID0gOTksIGFscGhhID0gMi4xLCByaG8gPSAwLjUsIHIgPSAtMC40KQ0Kc2VlZCA9IHNlZWQgKyAxDQpgYGANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KYGBge3J9DQp0ZXN0IDwtIHJ1bl9vbmVfc2VlZCgxMCwga19taW4gPSA0LCBrX21heCA9IDk5LCBhbHBoYSA9IDIuMSwgcmhvID0gMC41LCByID0gLTAuNCkNCnNlZWQgPSBzZWVkICsgMQ0KYGBgDQoNCmBgYHtyLCBvdXQud2lkdGg9IjYwJSJ9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcyhwYXN0ZTAoIi4vZmlndXJlcy9hbmltYXRpb25fbmV0d29ya18iLCBzZWVkICwiLmdpZiIpKQ0KYGBgDQoNCmBgYHtyfQ0KdGVzdCA8LSBydW5fb25lX3NlZWQoMTEsIGtfbWluID0gNCwga19tYXggPSA5OSwgYWxwaGEgPSAyLjEsIHJobyA9IDAuNSwgciA9IC0wLjQpDQpzZWVkID0gc2VlZCArIDENCmBgYA0KDQpgYGB7ciwgb3V0LndpZHRoPSI2MCUifQ0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MocGFzdGUwKCIuL2ZpZ3VyZXMvYW5pbWF0aW9uX25ldHdvcmtfIiwgc2VlZCAsIi5naWYiKSkNCmBgYA0KDQpgYGB7cn0NCnRlc3QgPC0gcnVuX29uZV9zZWVkKDEyLCBrX21pbiA9IDQsIGtfbWF4ID0gOTksIGFscGhhID0gMi4xLCByaG8gPSAwLjUsIHIgPSAtMC40KQ0Kc2VlZCA9IHNlZWQgKyAxDQpgYGANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KDQpgYGB7cn0NCnRlc3QgPC0gcnVuX29uZV9zZWVkKDEzLCBrX21pbiA9IDQsIGtfbWF4ID0gOTksIGFscGhhID0gMi4xLCByaG8gPSAwLjUsIHIgPSAtMC40KQ0Kc2VlZCA9IHNlZWQgKyAxDQpgYGANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KDQpgYGB7cn0NCnRlc3QgPC0gcnVuX29uZV9zZWVkKDE0LCBrX21pbiA9IDQsIGtfbWF4ID0gOTksIGFscGhhID0gMi4xLCByaG8gPSAwLjUsIHIgPSAtMC40KQ0Kc2VlZCA9IHNlZWQgKyAxDQpgYGANCg0KYGBge3IsIG91dC53aWR0aD0iNjAlIn0NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0KDQoNCiMjIDIuIHNtYWxsLXdvcmxkcw0KDQoNCmBgYHtyLCBldmFsID0gRkFMU0UsIGVjaG89VFJVRSwgZmlnLnNob3c9J2hvbGQnLCBmaWcua2VlcD0nYWxsJywgbWVzc2FnZT1GQUxTRSwgZmlnLmhlaWdodD01fQ0KcnVuX29uZV9zdyA8LSBmdW5jdGlvbigNCiAgaSwNCiAgYmFzZV9zZWVkID0gMTI1MzI4MSwNCiAgbW9kZWwgPSAid2F0dHMtc3Ryb2dhdHoiLA0KICBiZXRhID0gMCwNCiAgbmVpID0gMywNCiAgY2xpcXVlX3NpemUgPSA1LA0KICBwbWluID0gMC4xLA0KICANCiAgcGFyYW1zID0gbGlzdChzID0gMTUsIGUgPSAxMCwgdyA9IDQwLCB6ID0gNTAsIGxhbWJkYTEgPSA1LCBsYW1iZGEyID0gMS44KQ0KKSB7DQogICMgZGVyaXZlZCBzZWVkIGZvciB0aGlzIHJ1bg0KICBzZWVkX2kgPC0gYmFzZV9zZWVkICsgaQ0KICBzZXQuc2VlZChzZWVkX2kpDQoNCiAgaWYgKG1vZGVsID09ICJ3YXR0cy1zdHJvZ2F0eiIpIHsNCiAgICBuZXR3b3JrIDwtIHNhbXBsZV9zbWFsbHdvcmxkKGRpbSA9IDEsIHNpemUgPSAxMDAsIG5laSA9IDMsIHAgPSBiZXRhKSB9DQogIGVsc2UgaWYgKG1vZGVsID09ICJjYXZlbWFuIikgew0KICAgIG5ldHdvcmsgPC0gc2ltdWxhdGVfY2F2ZW1hbihuID0gMTAwLCBjbGlxdWVfc2l6ZSA9IGNsaXF1ZV9zaXplKSANCiAgfQ0KDQogIFYobmV0d29yaykkcm9sZSA8LSBzYW1wbGUoDQogICAgYyhyZXAoInRyZW5kc2V0dGVyIiwgcm91bmQoMTAwKnBtaW4pKSwgcmVwKCJjb25mb3JtaXN0IiwgMTAwLXJvdW5kKDEwMCpwbWluKSkpDQogICkNCiAgDQogIA0KICBmaW5hbF9uZXR3b3JrIDwtIG5ldHdvcmsNCg0KICANCiAgIyAtLS0gc3RhdHMgLS0tDQogIHN0YXRzIDwtIGxpc3QoDQogICAgcnVuICAgICAgICAgICA9IGksDQogICAgc2VlZCAgICAgICAgICA9IHNlZWRfaSwNCiAgICBudW1fbm9kZXMgICAgID0gdmNvdW50KGZpbmFsX25ldHdvcmspLA0KICAgIG51bV9lZGdlcyAgICAgPSBlY291bnQoZmluYWxfbmV0d29yayksDQogICAgYXZnX2RlZ3JlZSAgICA9IG1lYW4oZGVncmVlKGZpbmFsX25ldHdvcmspKSwNCiAgICBzZF9kZWdyZWUgICAgID0gc2QoZGVncmVlKGZpbmFsX25ldHdvcmspKSwNCiAgICBuZXRfZGVuc2l0eSAgID0gZWRnZV9kZW5zaXR5KGZpbmFsX25ldHdvcmspLA0KICAgIG5ldF9kaWFtZXRlciAgPSBkaWFtZXRlcihmaW5hbF9uZXR3b3JrLCBkaXJlY3RlZCA9IEZBTFNFLCB1bmNvbm5lY3RlZCA9IFRSVUUpLA0KICAgIGF2Z19wYXRoX2xlbiAgPSBhdmVyYWdlLnBhdGgubGVuZ3RoKGZpbmFsX25ldHdvcmssIGRpcmVjdGVkID0gRkFMU0UpLA0KICAgIGNsdXN0X2NvZWZmICAgPSB0cmFuc2l0aXZpdHkoZmluYWxfbmV0d29yaywgdHlwZSA9ICJnbG9iYWwiKSwNCiAgICBhc3NvcnRfZGVnICAgID0gYXNzb3J0YXRpdml0eV9kZWdyZWUoZmluYWxfbmV0d29yayksDQogICAgZGVnX3RyYWl0X2NvciA9IGZkZWd0cmFpdGNvcihmaW5hbF9uZXR3b3JrKSRjb3IsDQogICAgY29tcG9uZW50cyAgICA9IGNvbXBvbmVudHMoZmluYWxfbmV0d29yaykkbm8NCiAgKQ0KICANCiAgc3RhdHNfZGYgPC0gZGF0YS5mcmFtZSgNCiAgICBNZXRyaWMgPSBuYW1lcyhzdGF0cyksDQogICAgVmFsdWUgID0gdW5saXN0KHN0YXRzKSwNCiAgICByb3cubmFtZXMgPSBOVUxMDQogICkNCiAgDQogICNwcmludChzdGF0c19kZikNCiAgZnBsb3RfZ3JhcGgoZmluYWxfbmV0d29yaywgbGF5b3V0ID0gbGF5b3V0LmthbWFkYS5rYXdhaShmaW5hbF9uZXR3b3JrKSkNCiAgDQoNCiAgIyAtLS0gaW5pdGlhbCBhY3Rpb25zIC0tLQ0KICBWKGZpbmFsX25ldHdvcmspJGFjdGlvbiA8LSBpZmVsc2UoVihmaW5hbF9uZXR3b3JrKSRyb2xlID09ICJ0cmVuZHNldHRlciIsIDEsIDApDQogIA0KICAjIC0tLSBkZXRlcm1pbmlzdGljIHNpbXVsYXRpb24gLS0tDQogIHNpbV9kZXQgPC0gZmFibSgNCiAgICBuZXR3b3JrICAgICAgPSBmaW5hbF9uZXR3b3JrLA0KICAgIHBhcmFtcyAgICAgICA9IHBhcmFtcywNCiAgICBtYXhfcm91bmRzICAgPSA1MCwNCiAgICBtaV90aHJlc2hvbGQgPSAwLjQ5LA0KICAgIGNob2ljZV9ydWxlICA9ICJkZXRlcm1pbmlzdGljIiwNCiAgICBwbG90ICAgICAgICAgPSBUUlVFLA0KICAgIGhpc3RvcmllcyAgICA9IFRSVUUNCiAgKQ0KDQogICMgZ2VuZXJhdGUgdGhlIGdpZiBmb3IgdGhlIGN1cnJlbnQgbmV0d29yaw0KICBnaWZfZmlsZW5hbWUgPC0gcGFzdGUwKCIuL2ZpZ3VyZXMvYW5pbWF0aW9uX25ldHdvcmtfIiwgc2VlZF9pLCAiLmdpZiIpDQogIGdpZl9wYXRoIDwtIGZuZXR3b3JrZ2lmKGZpbmFsX25ldHdvcmssIHNpbV9kZXQkZGVjaXNpb25faGlzdG9yeSwgcm91bmRzID0gc2ltX2RldCRlcXVpbGlicml1bSRyb3VuZCwgb3V0cHV0X2RpciA9ICIuL2ZpZ3VyZXMiKQ0KICAjIHJlbmFtZSB0aGUgZ2lmIHRvIG1hdGNoIHRoZSBuYW1pbmcgcGF0dGVybg0KICBmaWxlLnJlbmFtZShnaWZfcGF0aCwgZ2lmX2ZpbGVuYW1lKQ0KICANCiAgDQogIGlmICghaXMubnVsbChzaW1fZGV0JHBsb3QpKSB7DQogICAgcHJpbnQoc2ltX2RldCRwbG90KQ0KICB9DQogIA0KICAjIC0tLSBwcm9iYWJpbGlzdGljIHNpbXVsYXRpb24gLS0tDQogIHNpbV9wcm9iIDwtIGZhYm0oDQogICAgbmV0d29yayAgICAgICAgICAgICAgICA9IGZpbmFsX25ldHdvcmssDQogICAgcGFyYW1zICAgICAgICAgICAgICAgICA9IHBhcmFtcywNCiAgICBtYXhfcm91bmRzICAgICAgICAgICAgID0gMTAwLA0KICAgIG1pX3RocmVzaG9sZCAgICAgICAgICAgPSAwLjQ5LA0KICAgIGNob2ljZV9ydWxlICAgICAgICAgICAgPSAicHJvYmFiaWxpc3RpYyIsDQogICAgc3RhYmxlX3dpbmRvdyAgICAgICAgICA9IDgsICAgIyB0aGUgbGVuZ3RoIG9mIHRoZSB3aW5kb3cgb2YgYWRvcHRpb24gdmFsdWVzDQogICAgcmVxdWlyZWRfc3RhYmxlX3JvdW5kcyA9IDIwLCAjIG51bWJlciBvZiB3aW5kb3dzIG5lZWRlZCB0byBkZWNsYXJlIGVxdWlsaWJyaXVtDQogICAgcGxvdCAgICAgICAgICAgICAgICAgICA9IFRSVUUNCiAgKQ0KICBpZiAoIWlzLm51bGwoc2ltX3Byb2IkcGxvdCkpIHsNCiAgICBwcmludChzaW1fcHJvYiRwbG90KQ0KICB9DQogIA0KICBsaXN0KA0KICAgICNydW4gICA9IGksDQogICAgI3NlZWQgID0gc2VlZF9pLA0KICAgIHNlZ3JlZ2F0aW9uX2RldCA9IHNpbV9kZXQkZXF1aWxpYnJpdW0kc2VncmVnYXRpb24sDQogICAgc2VncmVnYXRpb25fcHJvYiA9IHNpbV9wcm9iJGVxdWlsaWJyaXVtJHNlZ3JlZ2F0aW9uLA0KICAgIHN0YXRzID0gc3RhdHMNCiAgKQ0KfQ0KYGBgDQoNCmBgYHtyLCBldmFsID1GQUxTRX0NCnRlc3QgPC0gcnVuX29uZV9zdyhpPTE1LCBtb2RlbCA9ICJjYXZlbWFuIiwgY2xpcXVlX3NpemUgPSA1LCBwbWluID0gLjE1KQ0Kc2VlZCA9IHNlZWQgKyAxDQoNCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKHBhc3RlMCgiLi9maWd1cmVzL2FuaW1hdGlvbl9uZXR3b3JrXyIsIHNlZWQgLCIuZ2lmIikpDQpgYGANCg0K</div>
<style>
.center {
  text-align: center;
  color: red;
}
</style>
<hr>
<br>
<p id="yearPlaceholder" class="center">Copyright &copy; <span id="currentYear"></span> Rob Franken </p>

<script>
  // JavaScript code to get and display the current year
  var currentYear = new Date().getFullYear();
  document.getElementById("currentYear").innerHTML = currentYear;
</script>

</body>
</html>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("experiment.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
